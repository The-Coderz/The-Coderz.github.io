<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[ã€2017-01-08 coberturaã€‘]]></title>
      <url>https://The-Coderz.github.io/2017/01/08/2017-01-08-cobertura/</url>
      <content type="html"><![CDATA[<h2 id="cobertura"><a href="#cobertura" class="headerlink" title="cobertura"></a>cobertura</h2><h3 id="cobertura-website"><a href="#cobertura-website" class="headerlink" title="cobertura website"></a><a href="http://cobertura.sourceforge.net/" target="_blank" rel="external">cobertura website</a></h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coberturaæ˜¯ä¸€ä¸ªç”¨äºåˆ†æJavaå•æµ‹è¦†ç›–ç‡çš„å·¥å…·ï¼Œæˆ‘æŒ‰ç…§è‡ªå·±mavenå·¥ç¨‹é…ç½®ï¼Œæ¥è¯´ä¸‹å§ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œåæ­£æˆ‘å®˜ç½‘æ²¡æœ‰æ‰“å¼€è¿‡ï¼Œèµ„æ–™ä¹Ÿä¸å¤š</strong></p>
<hr>
<h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://www.mojohaus.org/cobertura-maven-plugin/" target="_blank" rel="external">apache maven plugin</a>ï¼Œè¿™ä¸ªå¯ä»¥æ‰“å¼€ğŸ˜‚ã€‚</p>
<h3 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;plugin&gt;</div><div class="line">  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;</div><div class="line">  &lt;artifactId&gt;cobertura-maven-plugin&lt;/artifactId&gt;</div><div class="line">  &lt;version&gt;$&#123;cobertura.version&#125;&lt;/version&gt;</div><div class="line">  &lt;configuration&gt;</div><div class="line">    &lt;instrumentation&gt;</div><div class="line">      &lt;includes&gt;			// è§„å®šè®¡ç®—å“ªä¸€éƒ¨åˆ†çš„å•æµ‹è¦†ç›–ç‡ï¼Œå¦‚DAOçš„è¦†ç›–ç‡æ²¡å¿…è¦è®¡ç®—</div><div class="line">        &lt;include&gt;com/van/service/**/*.class&lt;/include&gt;</div><div class="line">      &lt;/includes&gt;</div><div class="line">    &lt;/instrumentation&gt;</div><div class="line">  &lt;/configuration&gt;</div><div class="line">&lt;/plugin&gt;</div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; æŒ‰ç…§ä¸Šé¢çš„pomé…ç½®ï¼Œcoberturaåªä¼šè®¡ç®—com.van.service.**.*.classçš„å•æµ‹è¦†ç›–ç‡ã€‚åŒç†ï¼Œè¿˜å¯ä»¥é…ç½®<excludes>æ ‡ç­¾æ¥æ’é™¤ä¸éœ€è¦è®¡ç®—çš„ç±»ã€‚  </excludes></p>
<h3 id="è®¡ç®—"><a href="#è®¡ç®—" class="headerlink" title="è®¡ç®—"></a>è®¡ç®—</h3><p><code>mvn -B cobertura:cobertura -Dmaven.test.failure.ignore=true</code><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  æ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼Œä¼šåœ¨å¯¹åº”çš„targe/sit/cobertura/ä¸‹ç”Ÿæˆéœ€è¦çš„å†…å®¹ï¼Œæ‰“å¼€å¯¹åº”çš„index.htmlå³å¯ä»¥çœ‹åˆ°å•æµ‹è¦†ç›–ç‡ã€‚    </p>
<center><br><img src="/images/2017/01/08/coberturaæ‰§è¡Œ.png" alt="coberturaå‘½ä»¤æ‰§è¡Œ"><br><br><img src="/images/2017/01/08/coberturaç»Ÿè®¡ç»“æœ.png" alt="coberturaç»Ÿè®¡ç»“æœ"><br></center>

<h3 id="å€¼å¾—æ³¨æ„"><a href="#å€¼å¾—æ³¨æ„" class="headerlink" title="å€¼å¾—æ³¨æ„"></a>å€¼å¾—æ³¨æ„</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æˆ‘è‡ªå·±çš„æµ‹è¯•(mavne:3, cobertura-maven-plugin:5.0.2)å’Œstack overflowä¸Šçš„æé—®ä¸­ï¼Œéƒ½æœ‰ç±»ä¼¼çš„æƒ…å†µï¼šcoberturaçš„<ignore>æ ‡ç­¾åœ¨mavenä¸­ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œä¸è¿‡æœ‰<include>ã€<exclude>åº”è¯¥ä¹Ÿèƒ½æ»¡è¶³è¦æ±‚ã€‚<br><a href="http://stackoverflow.com/questions/25900958/cobertura-exclude-vs-ignore" target="_blank" rel="external">stack overflow - cobertura-exclude-vs-ignore</a></exclude></include></ignore></p>
<center><br><img src="/images/2017/01/08/stackoverflow-cobertura-ignore-vs-exclude.png" alt="cobertura stack overflow ignore vs exclude"><br></center>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Stethoå·¥å…·ä»‹ç»]]></title>
      <url>https://The-Coderz.github.io/2017/01/08/Stetho%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D/</url>
      <content type="html"><![CDATA[<p><a href="http://facebook.github.io/stetho/" target="_blank" rel="external">stetho</a>æ˜¯Facebookæ¨å‡ºçš„å®‰å“APPç½‘ç»œè¯Šæ–­å’Œæ•°æ®ç›‘æ§çš„å·¥å…·ï¼Œæ¥å…¥æ–¹ä¾¿ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ˜¯å¼€å‘è€…å¿…å¤‡çš„å¥½å·¥å…·ã€‚</p>
<p>ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>æŸ¥çœ‹Appçš„å¸ƒå±€</li>
<li>ç½‘ç»œè¯·æ±‚æŠ“åŒ…</li>
<li>æ•°æ®åº“ã€spæ–‡ä»¶æŸ¥çœ‹</li>
<li>è‡ªå®šä¹‰dumpappæ’ä»¶</li>
<li>å¯¹äºJavaScriptçš„æ”¯æŒ</li>
</ul>
<p>æ— éœ€rootï¼Œåªè¦èƒ½é€šè¿‡adbè¿æ¥è®¾å¤‡ï¼Œæ“ä½œæ–¹ä¾¿ã€‚</p>
<h2 id="æ¥å…¥æ–¹æ³•"><a href="#æ¥å…¥æ–¹æ³•" class="headerlink" title="æ¥å…¥æ–¹æ³•"></a>æ¥å…¥æ–¹æ³•</h2><h3 id="gradleé…ç½®"><a href="#gradleé…ç½®" class="headerlink" title="gradleé…ç½®"></a>gradleé…ç½®</h3><p>å› ä¸ºç›®å‰æˆ‘ä»¬çš„é¡¹ç›®ä¸­å·²ç»é›†æˆäº†okhttpï¼Œåªéœ€è¦åœ¨build.gradleæ·»åŠ å¦‚ä¸‹ä¸¤è¡Œé…ç½®</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">   <span class="comment">//...</span></div><div class="line"></div><div class="line">   compile <span class="string">'com.facebook.stetho:stetho-js-rhino:1.3.1'</span></div><div class="line">   compile <span class="string">'com.facebook.stetho:stetho-okhttp3:1.4.2'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>åœ¨Applicationç±»ä¸­å®Œæˆåˆå§‹åŒ–<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MyApplicationCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// ...</span></div><div class="line">     Stetho.initializeWithDefaults(mContext);</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<h2 id="ä½¿ç”¨åŠŸèƒ½"><a href="#ä½¿ç”¨åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨åŠŸèƒ½"></a>ä½¿ç”¨åŠŸèƒ½</h2><ol>
<li>adbæ–¹å¼è¿æ¥åˆ°è®¾å¤‡</li>
<li>è¿è¡Œdebugæ¨¡å¼çš„app</li>
<li>åœ¨Chromeæµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥chrome://inspect</li>
<li>é€‰æ‹©éœ€è¦inspectçš„åº”ç”¨è¿›ç¨‹<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1fbg4wwn5ftj21aw0qo7az.jpg" alt=""></li>
</ol>
<h3 id="æŸ¥çœ‹Appçš„å¸ƒå±€"><a href="#æŸ¥çœ‹Appçš„å¸ƒå±€" class="headerlink" title="æŸ¥çœ‹Appçš„å¸ƒå±€"></a>æŸ¥çœ‹Appçš„å¸ƒå±€</h3><p><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1fbfhku1ltsj21kw0s5tt8.jpg" alt=""></p>
<h3 id="ç½‘ç»œè¯Šæ–­"><a href="#ç½‘ç»œè¯Šæ–­" class="headerlink" title="ç½‘ç»œè¯Šæ–­"></a>ç½‘ç»œè¯Šæ–­</h3><p>ç»™OkHttpClientæ·»åŠ æ‹¦æˆªå™¨ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> OkHttpClient.Builder()</div><div class="line">    .addNetworkInterceptor(<span class="keyword">new</span> StethoInterceptor())</div><div class="line">    .build();</div></pre></td></tr></table></figure></p>
<p>ä¸»è¦åŠŸèƒ½æœ‰åŒ…æ‹¬ä¸‹è½½å›¾ç‰‡çš„é¢„è§ˆï¼ŒJSONæ•°æ®æŸ¥çœ‹ï¼Œç½‘ç»œè¯·æ±‚å†…å®¹å’Œè¿”å›å†…å®¹<br><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fbfhpn53jjj21kw0rjk3j.jpg" alt=""></p>
<h3 id="æ•°æ®åº“ã€spæ–‡ä»¶æŸ¥çœ‹"><a href="#æ•°æ®åº“ã€spæ–‡ä»¶æŸ¥çœ‹" class="headerlink" title="æ•°æ®åº“ã€spæ–‡ä»¶æŸ¥çœ‹"></a>æ•°æ®åº“ã€spæ–‡ä»¶æŸ¥çœ‹</h3><p><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1fbfhrmo7blj21kw0rvgx0.jpg" alt=""></p>
<p><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fbfhsqtl35j21kw0rq7fi.jpg" alt=""></p>
<h3 id="è‡ªå®šä¹‰dumpappæ’ä»¶"><a href="#è‡ªå®šä¹‰dumpappæ’ä»¶" class="headerlink" title="è‡ªå®šä¹‰dumpappæ’ä»¶"></a>è‡ªå®šä¹‰dumpappæ’ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Stetho.initialize(Stetho.newInitializerBuilder(context)</div><div class="line">        .enableDumpapp(<span class="keyword">new</span> DumperPluginsProvider() &#123;</div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="function"><span class="keyword">public</span> Iterable&lt;DumperPlugin&gt; <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Stetho.DefaultDumperPluginsBuilder(context)</div><div class="line">                .provide(<span class="keyword">new</span> HelloWorldDumperPlugin())</div><div class="line">                .provide(<span class="keyword">new</span> APODDumperPlugin(context.getContentResolver()))</div><div class="line">                .finish();</div><div class="line">          &#125;</div><div class="line">        &#125;)</div><div class="line">        .enableWebKitInspector(<span class="keyword">new</span> ExtInspectorModulesProvider(context))</div><div class="line">        .build());</div></pre></td></tr></table></figure>
<p>å…¶ä¸­HelloWorldDumperPluginå’ŒAPODDumperPluginæ˜¯è‡ªå®šä¹‰çš„æ’ä»¶ï¼Œå…·ä½“å†…å®¹å¯ä»¥å‚è€ƒ<a href="https://github.com/facebook/stetho/tree/master/stetho-sample" target="_blank" rel="external">Stethoæä¾›çš„sampleç¨‹åº</a><br>è¿è¡Œdumpappè„šæœ¬åä»¥è¾¾åˆ°ä¸appäº¤äº’é€šä¿¡çš„æ•ˆæœã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ ./dumpapp <span class="_">-l</span></div><div class="line">apod</div><div class="line">crash</div><div class="line">files</div><div class="line">hello</div><div class="line">hprof</div><div class="line">prefs</div></pre></td></tr></table></figure></p>
<h4 id="åŸç†ç®€ä»‹"><a href="#åŸç†ç®€ä»‹" class="headerlink" title="åŸç†ç®€ä»‹"></a>åŸç†ç®€ä»‹</h4><p>å…¶ä¸­dumpappæ˜¯ä¸€ä¸ªpythonè„šæœ¬ï¼Œé€šä¿¡çš„æ–¹å¼ä½¿ç”¨çš„æ˜¯androidæä¾›çš„<a href="https://android.googlesource.com/platform/system/core/+/master/adb/protocol.txt" target="_blank" rel="external">smartsocketæ¥å£</a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">--- smartsockets -------------------------------------------------------</div><div class="line">Port <span class="number">5037</span> is used <span class="keyword">for</span> smart sockets which allow a client on the host</div><div class="line">side to request access to a service <span class="keyword">in</span> the host adb daemon or <span class="keyword">in</span> the</div><div class="line">remote (device) daemon.  The service is requested by ascii name,</div><div class="line">preceeded by a <span class="number">4</span> digit hex length.  Upon successful connection an</div><div class="line"><span class="string">"OKAY"</span> response is sent, otherwise a <span class="string">"FAIL"</span> message is returned.  Once</div><div class="line">connected the client is talking to that (remote or local) service.</div><div class="line">client: &lt;hex4&gt; &lt;service-name&gt;</div><div class="line">server: "OKAY"</div><div class="line">client: &lt;hex4&gt; &lt;service-name&gt;</div><div class="line">server: "FAIL" &lt;hex4&gt; &lt;reason&gt;</div></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨PyCharm<a href="http://stackoverflow.com/questions/27952331/debugging-with-pycharm-terminal-arguments" target="_blank" rel="external">å¯¹Pythonè¿›è¡Œæ–­ç‚¹è°ƒè¯•</a>ï¼š<br><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fbfian208yj21kw0arwia.jpg" alt=""><br>è¿™æ®µè„šæœ¬çš„åŠŸèƒ½å°±æ˜¯é€šè¿‡è¯»å–<code>/proc/net/unix</code>æ–‡ä»¶å»æ‰¾appè®¾ç½®çš„socket<br><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fbfid70oipj21gs044t9m.jpg" alt=""></p>
<ol>
<li>æ‰«æandroidæ‰€æœ‰æä¾›socketåŠŸèƒ½çš„è®¾å¤‡ï¼Œæ‰¾åˆ°stehoçš„devtools_remote</li>
<li>å»ºç«‹ä¸ç¬¬ä¸€æ­¥æ‰¾åˆ°çš„è¿›ç¨‹socketï¼Œç„¶åé€šè¿‡smartsocketè¿›è¡Œé€šä¿¡ã€‚</li>
<li>è®¾å¤‡ä¸Šçš„appç›¸å½“äºä¸€ä¸ªæœåŠ¡å™¨ï¼Œè„šæœ¬æ˜¯å®¢æˆ·ç«¯å¯¹å®ƒè¿›è¡Œè®¿é—®</li>
</ol>
<p>åç¼€ä¸º_devtools_remoteçš„socketæ˜¯androidç•™ç»™chromeçš„åé—¨ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Note that _devtools_remote is a magic suffix understood by Chrome which //causes the discovery process to begin.</span></div></pre></td></tr></table></figure></p>
<p>è¯¦ç»†å†…å®¹å¯ä»¥çœ‹è¿™ç¯‡<a href="https://developer.chrome.com/devtools/docs/remote-debugging-legacy" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a><br>è¿™ç¯‡æ–‡æ¡£æä¾›çš„ä¾‹å­æ˜¯åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œå°±èƒ½åœ¨ç”µè„‘ä¸Šçœ‹åˆ°æ‰‹æœºchromeä¸­çš„å†…å®¹äº†ï¼š<br><code>adb forward tcp:9222 localabstract:chrome_devtools_remote</code></p>
<p><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fbfijp8jqfj21320lo0tp.jpg" alt=""></p>
<p>æ‰“å¼€çš„chrome-devtoolå…¶å®æ˜¯ä¸€ä¸ªwebsocketè¿æ¥ã€‚<br><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1fbfipebrd2j21kw069766.jpg" alt=""><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handlePageList</span><span class="params">(LightHttpResponse response)</span></span></div><div class="line">    <span class="keyword">throws</span> JSONException &#123;</div><div class="line">  <span class="keyword">if</span> (mPageListResponse == <span class="keyword">null</span>) &#123;</div><div class="line">    JSONArray reply = <span class="keyword">new</span> JSONArray();</div><div class="line">    JSONObject page = <span class="keyword">new</span> JSONObject();</div><div class="line">    page.put(<span class="string">"type"</span>, <span class="string">"app"</span>);</div><div class="line">    page.put(<span class="string">"title"</span>, makeTitle());</div><div class="line">    page.put(<span class="string">"id"</span>, PAGE_ID);</div><div class="line">    page.put(<span class="string">"description"</span>, <span class="string">""</span>);</div><div class="line"></div><div class="line">    page.put(<span class="string">"webSocketDebuggerUrl"</span>, <span class="string">"ws://"</span> + mInspectorPath);</div><div class="line">    Uri chromeFrontendUrl = <span class="keyword">new</span> Uri.Builder()</div><div class="line">        .scheme(<span class="string">"http"</span>)</div><div class="line">        .authority(<span class="string">"chrome-devtools-frontend.appspot.com"</span>)</div><div class="line">        .appendEncodedPath(<span class="string">"serve_rev"</span>)</div><div class="line">        .appendEncodedPath(WEBKIT_REV)</div><div class="line">        .appendEncodedPath(<span class="string">"devtools.html"</span>)</div><div class="line">        .appendQueryParameter(<span class="string">"ws"</span>, mInspectorPath)</div><div class="line">        .build();</div><div class="line">    page.put(<span class="string">"devtoolsFrontendUrl"</span>, chromeFrontendUrl.toString());</div><div class="line"></div><div class="line">    reply.put(page);</div><div class="line">    mPageListResponse = LightHttpBody.create(reply.toString(), <span class="string">"application/json"</span>);</div><div class="line">  &#125;</div><div class="line">  setSuccessfulResponse(response, mPageListResponse);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨androidä¸Šçš„æœåŠ¡ç«¯socketå†™æ³•,<br>è¯¦è§LocalSocketServerç±»çš„listenOnAddressæ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">listenOnAddress</span><span class="params">(String address)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">  mServerSocket = bindToSocket(address);</div><div class="line">  LogUtil.i(<span class="string">"Listening on @"</span> + address);</div><div class="line"></div><div class="line">  <span class="keyword">while</span> (!Thread.interrupted()) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="comment">// Use previously accepted socket the first time around, otherwise wait to accept another.</span></div><div class="line">      LocalSocket socket = mServerSocket.accept();</div><div class="line"></div><div class="line">      <span class="comment">// Start worker thread</span></div><div class="line">      Thread t = <span class="keyword">new</span> WorkerThread(socket, mSocketHandler);</div><div class="line">      t.setName(</div><div class="line">          WORKER_THREAD_NAME_PREFIX +</div><div class="line">          <span class="string">"-"</span> + mFriendlyName +</div><div class="line">          <span class="string">"-"</span> + mThreadId.incrementAndGet());</div><div class="line">      t.setDaemon(<span class="keyword">true</span>);</div><div class="line">      t.start();</div><div class="line">    &#125; <span class="keyword">catch</span> (SocketException se) &#123;</div><div class="line">      <span class="comment">// ignore exception if interrupting the thread</span></div><div class="line">      <span class="keyword">if</span> (Thread.interrupted()) &#123;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      &#125;</div><div class="line">      LogUtil.w(se, <span class="string">"I/O error"</span>);</div><div class="line">    &#125; <span class="keyword">catch</span> (InterruptedIOException ex) &#123;</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">      LogUtil.w(e, <span class="string">"I/O error initialising connection thread"</span>);</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  LogUtil.i(<span class="string">"Server shutdown on @"</span> + address);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="å¯¹äºJavaScriptçš„æ”¯æŒ"><a href="#å¯¹äºJavaScriptçš„æ”¯æŒ" class="headerlink" title="å¯¹äºJavaScriptçš„æ”¯æŒ"></a>å¯¹äºJavaScriptçš„æ”¯æŒ</h3><p>Chromeå¼€å‘è€…å·¥å…·åŸç”Ÿæ”¯æŒJavaScriptï¼Œæ‰€ä»¥Stethoä¹Ÿæä¾›äº†JavaScriptçš„æ”¯æŒã€‚<br>é€šè¿‡åœ¨consoleä¸­è¾“å…¥å¦‚ä¸‹ä»£ç å¯ä»¥è®©è®¾å¤‡appå¼¹å‡ºä¸€ä¸ªtoast<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">importPackage(android.widget);</div><div class="line">importPackage(android.os);</div><div class="line"><span class="keyword">var</span> handler = <span class="keyword">new</span> Handler(Looper.getMainLooper());</div><div class="line">handler.post(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; Toast.makeText(context, <span class="string">"Hello from JavaScript"</span>, Toast.LENGTH_LONG).show() &#125;);</div></pre></td></tr></table></figure></p>
<p><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fbfixpdt6hj21kw0rmgv8.jpg" alt=""><br>æ›´å¤šç©æ³•è§<a href="https://github.com/facebook/stetho/tree/master/stetho-js-rhino" target="_blank" rel="external">Rhino on Stetho
</a></p>
<hr>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="http://facebook.github.io/stetho/" target="_blank" rel="external">http://facebook.github.io/stetho/</a><br><a href="https://github.com/facebook/stetho/tree/master/stetho-js-rhino" target="_blank" rel="external">https://github.com/facebook/stetho/tree/master/stetho-js-rhino</a><br><a href="https://www.figotan.org/2016/04/18/using-stetho-to-diagnose-data-on-android/" target="_blank" rel="external">https://www.figotan.org/2016/04/18/using-stetho-to-diagnose-data-on-android/</a><br><a href="https://developer.chrome.com/devtools/docs/remote-debugging-legacy" target="_blank" rel="external">https://developer.chrome.com/devtools/docs/remote-debugging-legacy</a><br><a href="https://android.googlesource.com/platform/system/core/+/master/adb/protocol.txt" target="_blank" rel="external">https://android.googlesource.com/platform/system/core/+/master/adb/protocol.txt</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Pythonæ–­ç‚¹è°ƒè¯•]]></title>
      <url>https://The-Coderz.github.io/2017/01/08/Python%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95/</url>
      <content type="html"><![CDATA[<p>å¾ˆå¤šé¡¹ç›®æ˜¯ç”¨pythonå†™æ„å»ºè„šæœ¬çš„ï¼Œæ¯”å¦‚å¾®ä¿¡æœ€è¿‘å¼€æºçš„ç»ˆç«¯è·¨å¹³å°ç»„ä»¶ <a href="https://github.com/Tencent/mars" target="_blank" rel="external">Mars</a><br>æœ¬æ–‡å°†ä»¥marsä¸ºä¾‹ç®€å•ä»‹ç»ä¸‹å¦‚ä½•ç”¨<a href="https://www.jetbrains.com/pycharm/" target="_blank" rel="external">PyCharm</a>å¯¹pythonè¿›è¡Œæ–­ç‚¹è°ƒè¯•ã€‚</p>
<hr>
<h3 id="å¯¼å…¥ä»£ç "><a href="#å¯¼å…¥ä»£ç " class="headerlink" title="å¯¼å…¥ä»£ç "></a>å¯¼å…¥ä»£ç </h3><p>openæ•´ä¸ªmarsé¡¹ç›®ï¼Œåˆ‡æ¢åˆé€‚çš„pythonç‰ˆæœ¬ï¼Œmarséœ€è¦python2.7ç‰ˆæœ¬ã€‚<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1fbifkuh496j20h81f0q9j.jpg" alt=""><br><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fbifke5anpj20xm0du0xi.jpg" alt=""></p>
<h3 id="æ‰“æ–­ç‚¹"><a href="#æ‰“æ–­ç‚¹" class="headerlink" title="æ‰“æ–­ç‚¹"></a>æ‰“æ–­ç‚¹</h3><p><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fbifnm18q9j20gk04gt94.jpg" alt=""></p>
<h3 id="Debug-it"><a href="#Debug-it" class="headerlink" title="Debug it"></a>Debug it</h3><p><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1fbifo65ncyj20po0v6wm7.jpg" alt=""></p>
<p>å½“ä»£ç ä¸­éœ€è¦inputæ—¶ï¼Œåˆ‡æ¢åˆ°Consoleçª—å£è¾“å…¥<br><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fbifq7bsxlj20nm0e4jvb.jpg" alt=""></p>
<p><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fbifqp5rcaj211q0lutf5.jpg" alt=""></p>
<p>ç”¨PyCharmè°ƒè¯•è·ŸAndroid Studioä¸€æ ·ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ä¸€å®¶å…¬å¸çš„äº§å“ã€‚</p>
<hr>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ã€2017-01-05-powermockã€‘]]></title>
      <url>https://The-Coderz.github.io/2017/01/05/2017-01-05-powermock/</url>
      <content type="html"><![CDATA[<h2 id="PowerMock"><a href="#PowerMock" class="headerlink" title="PowerMock"></a>PowerMock</h2><h3 id="PowerMock-github-project"><a href="#PowerMock-github-project" class="headerlink" title="PowerMock github project"></a><a href="https://github.com/powermock/powermock" target="_blank" rel="external">PowerMock github project</a></h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PowerMockæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æµ‹è¯•æ¡†æ¶ï¼Œå®ƒé›†æˆäº†Mockitoã€EasyMockç­‰æµ‹è¯•æ¡†æ¶ï¼Œåœ¨åŸºäºè¿™äº›æ¡†æ¶çš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨ä¿®æ”¹å­—èŠ‚ç çš„æ‰‹æ®µmocké™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€åˆå§‹åŒ–æ–¹æ³•ï¼Œæ˜¯ä¸€ç§å¯¹è¿‡å»ç†Ÿæ‚‰çš„æµ‹è¯•æ¡†æ¶çš„å¢å¼ºæ‰©å¼ ã€‚</p>
<hr>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ol>
<li>å¼•å…¥PowerMockçš„jaråŒ…ï¼Œéœ€è¦æ³¨æ„ä¸åŒç‰ˆæœ¬çš„jaråŒ…ä¾èµ–çš„JUnitç‰ˆæœ¬ï¼›</li>
<li>å»ºç«‹æµ‹è¯•ç±»ï¼›</li>
<li>åˆ©ç”¨PowerMockå†™å•æµ‹ï¼›</li>
</ol>
<hr>
<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><h4 id="è¢«æµ‹è¯•æ¥å£ï¼šUserService"><a href="#è¢«æµ‹è¯•æ¥å£ï¼šUserService" class="headerlink" title="è¢«æµ‹è¯•æ¥å£ï¼šUserService"></a>è¢«æµ‹è¯•æ¥å£ï¼šUserService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.van.service;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * è¢«æµ‹è¯•ç±»</div><div class="line"> * Created by Wuha on 2017/1/8.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">    <span class="function">String <span class="title">thePublicMethod</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="è¢«æµ‹è¯•ç±»å®ç°ï¼šUserServiceImpl"><a href="#è¢«æµ‹è¯•ç±»å®ç°ï¼šUserServiceImpl" class="headerlink" title="è¢«æµ‹è¯•ç±»å®ç°ï¼šUserServiceImpl"></a>è¢«æµ‹è¯•ç±»å®ç°ï¼šUserServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.van.service.impl;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.van.UserDAO;</div><div class="line"><span class="keyword">import</span> com.van.service.UserService;</div><div class="line"><span class="keyword">import</span> com.van.util.UserUtil;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by Wuha on 2017/1/8.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> UserDAO userDAO;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Long XXXX_XXX_LONG;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String XXXX_XXXX_STRING;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.XXXX_XXX_LONG = <span class="number">0L</span>;</div><div class="line">        <span class="keyword">this</span>.XXXX_XXXX_STRING = <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(Long XXXX_XXX_LONG, String XXXX_XXXX_STRING)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.XXXX_XXX_LONG = XXXX_XXX_LONG;</div><div class="line">        <span class="keyword">this</span>.XXXX_XXXX_STRING = XXXX_XXXX_STRING;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">thePublicMethod</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// some logic</span></div><div class="line"></div><div class="line">        <span class="keyword">this</span>.thePrivateMethod();</div><div class="line"></div><div class="line">        userDAO.getUserById(XXXX_XXX_LONG);</div><div class="line"></div><div class="line">        UserUtil.theStaticMethod();</div><div class="line"></div><div class="line">        <span class="keyword">return</span> XXXX_XXXX_STRING;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">thePrivateMethod</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// some logic</span></div><div class="line">        File file = <span class="keyword">new</span> File(XXXX_XXXX_STRING);</div><div class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</div><div class="line">            <span class="comment">// do some thing</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"file.exist() method mock failed."</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="è¢«æµ‹è¯•ç±»è°ƒç”¨çš„é™æ€æ–¹æ³•"><a href="#è¢«æµ‹è¯•ç±»è°ƒç”¨çš„é™æ€æ–¹æ³•" class="headerlink" title="è¢«æµ‹è¯•ç±»è°ƒç”¨çš„é™æ€æ–¹æ³•"></a>è¢«æµ‹è¯•ç±»è°ƒç”¨çš„é™æ€æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.van.util;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by Wuha on 2017/1/8.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserUtil</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">theStaticMethod</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// some logic</span></div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"static method mock failed."</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æµ‹è¯•ç±»"><a href="#æµ‹è¯•ç±»" class="headerlink" title="æµ‹è¯•ç±»"></a>æµ‹è¯•ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.van.test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.van.UserDAO;</div><div class="line"><span class="keyword">import</span> com.van.service.UserService;</div><div class="line"><span class="keyword">import</span> com.van.service.impl.UserServiceImpl;</div><div class="line"><span class="keyword">import</span> com.van.util.UserUtil;</div><div class="line"><span class="keyword">import</span> org.junit.Assert;</div><div class="line"><span class="keyword">import</span> org.junit.Before;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.mockito.*;</div><div class="line"><span class="keyword">import</span> org.powermock.api.mockito.PowerMockito;</div><div class="line"><span class="keyword">import</span> org.powermock.core.classloader.annotations.PrepareOnlyThisForTest;</div><div class="line"><span class="keyword">import</span> org.powermock.modules.junit4.PowerMockRunner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by Wuha on 2017/1/8.</div><div class="line"> */</div><div class="line"><span class="meta">@RunWith</span>(PowerMockRunner.class)     <span class="comment">// æµ‹è¯•è¿è¡ŒäºPowerMockæµ‹è¯•æ¡†æ¶ä¸‹,åŠ è½½ç‰¹å®šå¯¹è±¡ã€æ¸…é™¤MockRepositoryç­‰</span></div><div class="line"><span class="meta">@PrepareOnlyThisForTest</span>(&#123;UserUtil.class, UserServiceImpl.class&#125;)    <span class="comment">// è¯¥åœ¨æ³¨è§£æ ‡æ˜äº†éœ€è¦ç”¨PowerMockå­—èŠ‚ç å¢å¼ºçš„ç±»,å¦‚:mocké™æ€æ–¹æ³•ã€finalåŸŸã€ç§æœ‰æ–¹æ³•ç­‰</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceTest</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXPECTED_STRING = <span class="string">"Hello world."</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Long EXPECTED_LONG = -<span class="number">1L</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Mock</span>                           <span class="comment">// mock ä¸€ä¸ªUserDAOç±»</span></div><div class="line">    <span class="keyword">private</span> UserDAO uerDAO;</div><div class="line"></div><div class="line">    <span class="meta">@Mock</span></div><div class="line">    <span class="keyword">private</span> File mockFile;</div><div class="line"></div><div class="line">    <span class="meta">@Spy</span>  <span class="comment">// spy ä¸€ä¸ªç±»,è¿™ä¸ªæ³¨è§£äº§ç”Ÿçš„ç±»,å¦‚æœä¸å»mockæ–¹æ³•,é‚£ä¹ˆåœ¨è¿è¡Œå®ƒçš„æ—¶å€™,ä¼šè°ƒç”¨å®é™…çš„æ–¹æ³•,è¿™ç‚¹å’ŒmockObject.thenCallRealMethod()æ•ˆæœä¸€æ ·</span></div><div class="line">    <span class="meta">@InjectMocks</span>    <span class="comment">// ç”±äºUserServiceåˆ©ç”¨äº†@Autowiredæ³¨è§£,è€Œæ²¡æœ‰publicçš„setteræ–¹æ³•,è¯¥æ³¨è§£å¯ä»¥å¸®åŠ©å§userDAOç»™setåˆ°serviceä¸­</span></div><div class="line">    <span class="keyword">private</span> UserService userService = <span class="keyword">new</span> UserServiceImpl(EXPECTED_LONG, EXPECTED_STRING);</div><div class="line"></div><div class="line">    <span class="meta">@Before</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * å¯¹æ³¨è§£çš„å¯¹è±¡è¿›è¡Œè¯­ä¹‰é€»è¾‘å¤„ç†</div><div class="line">         */</div><div class="line">        MockitoAnnotations.initMocks(<span class="keyword">this</span>);</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * mockå¤„ç†é™æ€ç±»</div><div class="line">         */</div><div class="line">        PowerMockito.mockStatic(UserUtil.class);</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * mock some method</div><div class="line">         */</div><div class="line">        PowerMockito.when(mockFile.exists()).thenReturn(<span class="keyword">true</span>);</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * mockä¸€ä¸ªconstructæ–¹æ³•</div><div class="line">         */</div><div class="line">        PowerMockito.whenNew(File.class).withArguments(Mockito.anyString()).thenReturn(mockFile);</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * mock static method, the private method mock is the same</div><div class="line">         */</div><div class="line">        PowerMockito.doNothing().when(UserUtil.class, <span class="string">"theStaticMethod"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testThePublicMethod</span><span class="params">()</span> </span>&#123;</div><div class="line">        Assert.assertEquals(EXPECTED_STRING, userService.thePublicMethod());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><center><br><img src="/images/2017/01/08/powermockè¿è¡Œç»“æœ.png" alt="PowerMockè¿è¡Œç»“æœ"><br></center>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æŒ‰ç…§ä»£ç ä¸­çš„é€»è¾‘ï¼Œå¦‚æœæ²¡è¢«mockï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ä½¿ç”¨TraceViewå·¥å…·å®šä½è€—æ—¶æ“ä½œ]]></title>
      <url>https://The-Coderz.github.io/2017/01/05/2016-12-27-%E9%80%9A%E8%BF%87trace%E6%96%87%E4%BB%B6%E5%AE%9A%E4%BD%8D%E8%80%97%E6%97%B6%E6%93%8D%E4%BD%9C/</url>
      <content type="html"><![CDATA[<p><a href="https://developer.android.com/studio/profile/traceview.html" target="_blank" rel="external">TraceView</a>æ˜¯DDMSä¸­çš„å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥å®šä½Android appä¸­javaæ–¹æ³•çš„è€—æ—¶æ“ä½œã€‚</p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><h3 id="1-ç”Ÿæˆtraceæ–‡ä»¶"><a href="#1-ç”Ÿæˆtraceæ–‡ä»¶" class="headerlink" title="1.ç”Ÿæˆtraceæ–‡ä»¶"></a>1.ç”Ÿæˆtraceæ–‡ä»¶</h3><p>Eclipseä¸­ç”Ÿæˆtraceæ–‡ä»¶çš„æ–¹æ³•ï¼š<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1fb5lfcb484j20zg0pmtf7.jpg" alt=""></p>
<p><br><br>Android Studioç”Ÿæˆtraceæ–‡ä»¶çš„æ–¹æ³•:</p>
<p><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fb5lgu5dsmj21kw0fmgpk.jpg" alt=""></p>
<p>ç”Ÿæˆçš„traceæ–‡ä»¶å°†æ˜¾ç¤ºåœ¨Capturesçª—å£</p>
<p><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fb5lx8hffej20a707jmxe.jpg" alt=""><br>ç›´æ¥æŠŠtraceæ–‡ä»¶æ‹–åˆ°å®‰è£…äº†ADTæ’ä»¶çš„Eclipseå°±èƒ½æ‰“å¼€ã€‚</p>
<h3 id="2-Timeline-Panel"><a href="#2-Timeline-Panel" class="headerlink" title="2.Timeline Panel"></a>2.Timeline Panel</h3><p>Timelineå±•ç¤ºå„ä¸ªçº¿ç¨‹å ç”¨CPUçš„æƒ…å†µã€‚<br>æ¨ªè½´ä¸ºä»å¼€å§‹åˆ°ç»“æŸtraceçš„CPUæ—¶é—´ï¼Œå³è¾¹çºµè½´è¡¨ç¤ºå„ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸€æ¨ªæ’è¡¨ç¤ºçº¿ç¨‹å ç”¨CPUçš„æƒ…å†µã€‚è¿™é‡Œä¸»è¦çœ‹ä¸»çº¿ç¨‹main</p>
<p><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1fb5lrgshrqj21kw07jtbu.jpg" alt=""></p>
<p>æ”¾å¤§åçš„æ•ˆæœå¦‚å›¾ï¼Œæ¯ä¸ªmethodç”¨ä¸åŒçš„é¢œè‰²è¡¨ç¤ºï¼Œå±•ç¤ºCPUè°ƒç”¨è¯¥æ–¹æ³•åˆ°ç»“æŸè°ƒç”¨çš„æ—¶é—´ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1fb5m32u3j6j21am0bcn0k.jpg" alt=""></p>
<h3 id="3-Profile-Panel"><a href="#3-Profile-Panel" class="headerlink" title="3.Profile Panel"></a>3.Profile Panel</h3><p>Profile Panelå±•ç¤ºäº†æ–¹æ³•å…¨åï¼Œæ–¹æ³•è€—æ—¶ï¼Œè°ƒç”¨æ¬¡æ•°ï¼ŒåŠæ–¹æ³•çš„è°ƒç”¨é“¾å…³ç³»ã€‚<br>åœ¨è¿™é‡Œè°ƒç”¨æ–¹æ³•ç§°ä¸ºâ€parentâ€,è¢«è°ƒæ–¹æ³•ç§°ä¸ºâ€childrenâ€.</p>
<p><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fb5mewco9uj21kw0ngtsb.jpg" alt=""></p>
<hr>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ã€ŠHigh Performance Android Appsã€‹</p>
<p><a href="https://developer.android.com/studio/profile/traceview.html" target="_blank" rel="external">https://developer.android.com/studio/profile/traceview.html</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[simple-mock-api]]></title>
      <url>https://The-Coderz.github.io/2017/01/05/simple-mock-api/</url>
      <content type="html"><![CDATA[<p>é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªActiviyéœ€è¦è½®è¯¢å¤šä¸ªæ¥å£ï¼Œå®æ—¶åˆ·æ–°æ•°æ®ã€‚è¿™é‡Œå¾ˆå¤šä¸šåŠ¡é€»è¾‘éƒ½éœ€è¦ä¾èµ–å½“å‰çš„çŠ¶æ€ï¼Œæ‰€ä»¥ç®€å•å†™äº†ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œç”¨äºç”Ÿæˆä¸€äº›mock dataï¼Œå¹¶ä¸”æ”¯æŒæ•°æ®å®æ—¶åˆ·æ–°ã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/FelixZhang00/simple-mock-api" target="_blank" rel="external">simple-mock-api</a></p>
<p>æŒ‚åˆ°<a href="https://www.qcloud.com/" target="_blank" rel="external">è…¾è®¯äº‘</a>ä¸Šå°±å¯ä»¥å…¬ç½‘è®¿é—®äº†ã€‚</p>
<hr>
<h1 id="simple-mock-api"><a href="#simple-mock-api" class="headerlink" title="simple-mock-api"></a>simple-mock-api</h1><p>Use <a href="https://github.com/typicode/json-server" target="_blank" rel="external">json-server</a> make this simple mock api server.</p>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><ol>
<li>checkout this project,and cd</li>
<li>type <code>npm install</code> in terminal to install dependences</li>
<li>run <code>node app.js</code></li>
<li>get result via your configed cgiï¼Œlike <a href="http://localhost:3000/get_match_players" target="_blank" rel="external">http://localhost:3000/get_match_players</a></li>
</ol>
<h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><p>You can config </p>
<pre><code>cgiï¼Œ
default json file,
custom handle the request, modify json response
</code></pre><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>Create a <code>get_match_detail.json</code> file in <code>data</code> folder.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"state"</span>: <span class="number">1</span>,</div><div class="line">  <span class="attr">"title"</span>:<span class="string">"NBA"</span>,</div><div class="line">  <span class="attr">"time"</span>:<span class="string">"2017-01-01"</span>,</div><div class="line">  <span class="attr">"homescore"</span>: <span class="string">"101"</span>,</div><div class="line">  <span class="attr">"guestscore"</span>: <span class="string">"115"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In <code>config.js</code> config you mock api</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">var config = [</div><div class="line">&#123;</div><div class="line">	"cgi":"/get_match_detail",</div><div class="line">	"filepath":"data/get_match_detail.json",</div><div class="line">	"need_cache":true,</div><div class="line">	"hookfunc":func_get_match_detail</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">	"cgi":"/get_match_players",</div><div class="line">	"filepath":"data/get_match_players.json",</div><div class="line">	"need_cache":false,</div><div class="line">	"hookfunc":func_get_match_players</div><div class="line">&#125;,</div><div class="line"></div><div class="line">];</div></pre></td></tr></table></figure>
<p>You can custom handle the request by define your custom â€œhookfuncâ€, like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> func_get_match_detail = <span class="function"><span class="keyword">function</span>(<span class="params">defaultObj,req</span>) </span>&#123;</div><div class="line">	<span class="comment">//increase homescore every time</span></div><div class="line">	<span class="keyword">var</span> homescore = <span class="built_in">parseInt</span>(defaultObj.homescore)+<span class="number">1</span>+<span class="string">""</span>;</div><div class="line">	defaultObj.homescore = homescore;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The param <code>defaultObj</code> means the parsed json object you defined in the key â€œfilepathâ€. </p>
<p>If the key â€œneed_cacheâ€ seted true, than your hookfunc can change the defaultObj in the cache forever.</p>
<h3 id="Start-JSON-Server"><a href="#Start-JSON-Server" class="headerlink" title="Start JSON Server"></a>Start JSON Server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ node app.js</div></pre></td></tr></table></figure>
<p>Now if you go to <a href="http://localhost:3000/get_match_detail" target="_blank" rel="external">http://localhost:3000/get_match_detail</a>, youâ€™ll get</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"state"</span>: <span class="number">1</span>,</div><div class="line">  <span class="attr">"title"</span>:<span class="string">"NBA"</span>,</div><div class="line">  <span class="attr">"time"</span>:<span class="string">"2017-01-01"</span>,</div><div class="line">  <span class="attr">"homescore"</span>: <span class="string">"102"</span>,</div><div class="line">  <span class="attr">"guestscore"</span>: <span class="string">"115"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>and the homescoreâ€™s value changed every time when you go to the same link.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Postman]]></title>
      <url>https://The-Coderz.github.io/2016/12/28/Postman/</url>
      <content type="html"><![CDATA[<h2 id="Postmanå·¥å…·"><a href="#Postmanå·¥å…·" class="headerlink" title="Postmanå·¥å…·"></a>Postmanå·¥å…·</h2><p><strong><a href="https://www.getpostman.com/docs/" target="_blank" rel="external">Docs</a></strong></p>
<h3 id="å˜é‡è®¾ç½®"><a href="#å˜é‡è®¾ç½®" class="headerlink" title="å˜é‡è®¾ç½®"></a>å˜é‡è®¾ç½®</h3><center><br><img src="/images/2016/12/28/Postmanè®¾ç½®å˜é‡1.png" alt=""><br><br><br><img src="/images/2016/12/28/Postmanè®¾ç½®å˜é‡2.png" alt=""><br><br><img src="/images/2016/12/28/Postmanè®¾ç½®å˜é‡3.png" alt=""><br></center>


<h3 id="é¢„è°ƒç”¨è„šæœ¬"><a href="#é¢„è°ƒç”¨è„šæœ¬" class="headerlink" title="é¢„è°ƒç”¨è„šæœ¬"></a>é¢„è°ƒç”¨è„šæœ¬</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é‡åˆ°éšç€æ—¶é—´å˜åŒ–çš„å˜é‡ï¼Œè­¬å¦‚ï¼šè®¤è¯keyï¼Œåœ¨ä¹‹å‰ç®€å•çš„å˜é‡è®¾ç½®å°±æ˜¾å¾—æœ‰äº›ä¸è¶³äº†ã€‚æœ€å¥½å°±æ˜¯åœ¨è°ƒç”¨è„šæœ¬çš„æ—¶å€™ï¼Œèƒ½è‡ªåŠ¨æŒ‰ç…§è§„åˆ™è®¡ç®—å‡ºå˜é‡çš„å€¼ï¼Œå¹¶ä¸”æŠŠå˜é‡è¿™åªåˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚Postmançš„Pre-request Scriptå°±æ˜¯å¾ˆå¥½çš„è§£å†³é€”å¾„ã€‚</p>
<center><br><img src="/images/2016/12/28/Postman-pre-request-script-01.png" alt=""><br></center>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ­¤æ—¶ï¼Œåœ¨ç”¨<code>{ { token } }</code>è¿™æ ·çš„ç¯å¢ƒå˜é‡å½¢å¼(å’Œä¸Šé¢æåˆ°çš„ä¸€æ ·)ï¼Œå°±å¯ä»¥äº†ã€‚</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ELFæ–‡ä»¶è£…è½½é“¾æ¥è¿‡ç¨‹åŠhookåŸç†]]></title>
      <url>https://The-Coderz.github.io/2016/12/28/2016-12-24-ELF%E6%96%87%E4%BB%B6%E8%A3%85%E8%BD%BD%E9%93%BE%E6%8E%A5%E8%BF%87%E7%A8%8B%E5%8F%8Ahook%E5%8E%9F%E7%90%86/</url>
      <content type="html"><![CDATA[<h2 id="ELFæ–‡ä»¶æ ¼å¼è§£æ"><a href="#ELFæ–‡ä»¶æ ¼å¼è§£æ" class="headerlink" title="ELFæ–‡ä»¶æ ¼å¼è§£æ"></a>ELFæ–‡ä»¶æ ¼å¼è§£æ</h2><p>å¯æ‰§è¡Œå’Œå¯é“¾æ¥æ ¼å¼(Executable and Linkable Formatï¼Œç¼©å†™ä¸ºELF)ï¼Œå¸¸è¢«ç§°ä¸ºELFæ ¼å¼ï¼Œåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæ˜¯ä¸€ç§ç”¨äºæ‰§è¡Œæ¡£ã€ç›®çš„æ¡£ã€å…±äº«åº“å’Œæ ¸å¿ƒè½¬å‚¨çš„æ ‡å‡†æ–‡ä»¶æ ¼å¼ã€‚</p>
<p>ELFæ–‡ä»¶ä¸»è¦æœ‰å››ç§ç±»å‹ï¼š</p>
<ul>
<li>å¯é‡å®šä½æ–‡ä»¶ï¼ˆRelocatable Fileï¼‰ åŒ…å«é€‚åˆäºä¸å…¶ä»–ç›®æ ‡æ–‡ä»¶é“¾æ¥æ¥åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…å…±äº«ç›®æ ‡æ–‡ä»¶çš„ä»£ç å’Œæ•°æ®ã€‚</li>
<li>å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆExecutable Fileï¼‰ åŒ…å«é€‚åˆäºæ‰§è¡Œçš„ä¸€ä¸ªç¨‹åºï¼Œæ­¤æ–‡ä»¶è§„å®šäº† exec() å¦‚ä½•åˆ›å»ºä¸€ä¸ªç¨‹åºçš„è¿›ç¨‹æ˜ åƒã€‚</li>
<li>å…±äº«ç›®æ ‡æ–‡ä»¶ï¼ˆShared Object Fileï¼‰ åŒ…å«å¯åœ¨ä¸¤ç§ä¸Šä¸‹æ–‡ä¸­é“¾æ¥çš„ä»£ç å’Œæ•°æ®ã€‚é¦–å…ˆé“¾æ¥ç¼–è¾‘å™¨å¯ä»¥å°†å®ƒå’Œå…¶å®ƒå¯é‡å®šä½æ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶ä¸€èµ·å¤„ç†ï¼Œç”Ÿæˆå¦å¤–ä¸€ä¸ªç›®æ ‡æ–‡ä»¶ã€‚å…¶æ¬¡ï¼ŒåŠ¨æ€é“¾æ¥å™¨ï¼ˆDynamic Linkerï¼‰å¯èƒ½å°†å®ƒä¸æŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä»¥åŠå…¶å®ƒå…±äº«ç›®æ ‡ä¸€èµ·ç»„åˆï¼Œåˆ›å»ºè¿›ç¨‹æ˜ åƒã€‚</li>
</ul>
<p>ä»¥ä¸€ä¸ªç®€å•çš„ç›®æ ‡æ–‡ä»¶ä¸ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">int global_init_var = 84;</div><div class="line">int global_uninit_var;</div><div class="line">void func1(int i)</div><div class="line">&#123;</div><div class="line">    printf(&quot;%d\n&quot;,i);</div><div class="line">&#125;</div><div class="line">int main(void)</div><div class="line">&#123;</div><div class="line">    char *str = &quot;hello&quot;;</div><div class="line">    static int static_var = 85;</div><div class="line">    static int static_var2;</div><div class="line">    int a = 1;</div><div class="line">    int b;</div><div class="line">    func1(static_var + static_var2 + a + b);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -c SimpleSection.c</div></pre></td></tr></table></figure>
<h3 id="ELFæ–‡ä»¶ç»“æ„"><a href="#ELFæ–‡ä»¶ç»“æ„" class="headerlink" title="ELFæ–‡ä»¶ç»“æ„"></a>ELFæ–‡ä»¶ç»“æ„</h3><p><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92kqr2mfoj20ty14k76x.jpg" alt="ELFæ–‡ä»¶ç»“æ„"></p>
<h3 id="é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾"><a href="#é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾" class="headerlink" title="é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾"></a>é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾</h3><p>ELFæ–‡ä»¶åœ¨ç£ç›˜ä¸­å’Œè¢«åŠ è½½åˆ°å†…å­˜ä¸­å¹¶ä¸æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼ŒELFæ–‡ä»¶æä¾›äº†ä¸¤ç§è§†å›¾æ¥åæ˜ è¿™ä¸¤ç§æƒ…å†µ:é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾ã€‚é¡¾åæ€ä¹‰ï¼Œé“¾æ¥è§†å›¾å°±æ˜¯åœ¨é“¾æ¥æ—¶ç”¨åˆ°çš„è§†å›¾ï¼Œè€Œæ‰§è¡Œè§†å›¾åˆ™æ˜¯åœ¨æ‰§è¡Œæ—¶ç”¨åˆ°çš„è§†å›¾ã€‚<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f92kvnpkstj20bz06fwf8.jpg" alt="é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾"></p>
<p>ç¨‹åºå¤´éƒ¨è¡¨(Program Header Table)ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œå‘Šè¯‰ç³»ç»Ÿå¦‚ä½•åˆ›å»ºè¿›ç¨‹æ˜ åƒã€‚<br>èŠ‚åŒºå¤´éƒ¨è¡¨(Section Header Table)åŒ…å«äº†æè¿°æ–‡ä»¶èŠ‚åŒºçš„ä¿¡æ¯ï¼Œæ¯”å¦‚å¤§å°ï¼Œåç§»ç­‰ã€‚</p>
<h3 id="ELFæ–‡ä»¶å¤´ï¼ˆELF-Headerï¼‰"><a href="#ELFæ–‡ä»¶å¤´ï¼ˆELF-Headerï¼‰" class="headerlink" title="ELFæ–‡ä»¶å¤´ï¼ˆELF Headerï¼‰"></a>ELFæ–‡ä»¶å¤´ï¼ˆELF Headerï¼‰</h3><p>å®šä¹‰äº†ELFé­”æ•°ã€ç¡¬ä»¶å¹³å°ç­‰ã€<br>å…¥å£åœ°å€ã€ç¨‹åºå¤´å…¥å£å’Œé•¿åº¦ã€<br>æ®µè¡¨çš„ä½ç½®å’Œé•¿åº¦åŠæ®µçš„æ•°é‡ã€<br>æ®µè¡¨å­—ç¬¦ä¸²è¡¨ï¼ˆ.shstrtabï¼‰æ‰€åœ¨çš„æ®µåœ¨æ®µè¡¨ä¸­çš„ä¸‹æ ‡ã€‚</p>
<p>å¯ä»¥åœ¨â€/usr/include/elf.hâ€ä¸­æ‰¾åˆ°å®ƒçš„å®šä¹‰ï¼ˆElf32_Ehdrï¼‰ã€‚<br>ELFå„ä¸ªå­—æ®µçš„è¯´æ˜:</p>
<p><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92kwlnz2ej20ht0snqbv.jpg" alt=""></p>
<h3 id="æ®µè¡¨-Section-Header-Table"><a href="#æ®µè¡¨-Section-Header-Table" class="headerlink" title="æ®µè¡¨(Section Header Table)"></a>æ®µè¡¨(Section Header Table)</h3><p>æè¿°äº†å„ä¸ªæ®µçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ¯ä¸ªæ®µçš„æ®µåã€æ®µçš„é•¿åº¦ã€åœ¨æ–‡ä»¶ä¸­çš„åç§»ã€è¯»å†™æƒé™åŠæ®µçš„å…¶å®ƒå±æ€§ã€‚<br>æ®µè¡¨çš„ç»“æ„æ˜¯ä¸€ä¸ªä»¥Elf32_Shdrç»“æ„ä½“ï¼ˆæ®µæè¿°ç¬¦ï¼‰ä¸ºå…ƒç´ çš„æ•°ç»„ã€‚<br>æ¯ä¸ªElf32_Shdrç»“æ„ä½“å¯¹åº”ä¸€ä¸ªæ®µã€‚<br>ä½¿ç”¨readelfå·¥å…·æŸ¥çœ‹ELFæ–‡ä»¶çš„æ®µ:<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f92kx9tdv3j21kw0sfak2.jpg" alt=""></p>
<p><strong>æ®µæè¿°ç¬¦ï¼ˆElf32_Shdrï¼‰</strong>çš„å„ä¸ªæˆå‘˜åŠå«ä¹‰ï¼š<br><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1f92kyt2f0gj21kw1oq4j0.jpg" alt=""></p>
<p><strong>æ®µçš„ç±»å‹(sh_type)</strong><br>å¯¹äºç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ï¼Œä¸»è¦å†³å®šæ®µçš„å±æ€§çš„æ˜¯æ®µçš„ç±»å‹(sh_type)å’Œæ®µçš„æ ‡å¿—ä½(shflags)ã€‚æ®µçš„ç±»å‹ç›¸å…³å¸¸é‡ä»¥SHTå¼€å¤´ï¼Œåˆ—ä¸¾å¦‚ä¸‹è¡¨ã€‚<br><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1f92l0g93grj20k80bg0vq.jpg" alt=""></p>
<p><strong>æ®µçš„æ ‡å¿—ä½(sh<em>flag)</em></strong>è¡¨ç¤ºè¯¥èŠ‚åœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å±æ€§ï¼Œæ¯”å¦‚æ˜¯å¦å¯å†™ï¼Œæ˜¯å¦å¯æ‰§è¡Œç­‰ã€‚ç›¸å…³å¸¸é‡ä»¥SHFå¼€å¤´ï¼Œå¦‚ä¸‹è¡¨ï¼š<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1f92l38ufjqj20k504sjsn.jpg" alt=""></p>
<p><strong>æ®µçš„é“¾æ¥ä¿¡æ¯(sh_linkã€sh_info)</strong> å¦‚æœèŠ‚çš„ç±»å‹æ˜¯å’Œé“¾æ¥ç›¸å…³çš„ï¼Œæ¯”å¦‚é‡å®šä½è¡¨ã€ç¬¦å·è¡¨ç­‰ï¼Œé‚£ä¹ˆsh_linkå’Œsh_infoä¸¤ä¸ªæˆå‘˜åŒ…å«çš„æ„ä¹‰å¦‚ä¸‹ã€‚å¯¹äºå…¶ä»–æ®µï¼Œè¿™ä¸¤ä¸ªæˆå‘˜æ²¡æœ‰æ„ä¹‰ã€‚<br><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1f92l3seot7j20kd06babi.jpg" alt=""></p>
<h3 id="ä»£ç æ®µ-text"><a href="#ä»£ç æ®µ-text" class="headerlink" title="ä»£ç æ®µ(.text)"></a>ä»£ç æ®µ(.text)</h3><p>ä½¿ç”¨objdumpå·¥å…·æŸ¥çœ‹ä»£ç æ®µçš„å†…å®¹ï¼Œâ€-dâ€å‚æ•°å°†æ‰€æœ‰åŒ…å«æŒ‡ä»¤çš„æ®µåæ±‡ç¼–ã€‚<br><img src="http://ww1.sinaimg.cn/mw690/8b331ee1gw1f92l64fa4ej21b41q2114.jpg" alt=""></p>
<h3 id="æ•°æ®æ®µ-data-å’Œåªè¯»æ•°æ®æ®µ-rodata"><a href="#æ•°æ®æ®µ-data-å’Œåªè¯»æ•°æ®æ®µ-rodata" class="headerlink" title="æ•°æ®æ®µ(.data)å’Œåªè¯»æ•°æ®æ®µ(.rodata)"></a>æ•°æ®æ®µ(.data)å’Œåªè¯»æ•°æ®æ®µ(.rodata)</h3><p>.dataæ®µä¿å­˜çš„æ˜¯é‚£äº›å·²ç»åˆå§‹åŒ–äº†çš„å…¨å±€é™æ€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡ã€‚å‰é¢SimpleSection.cä»£ç é‡Œé¢ä¸€å…±æœ‰ä¸¤ä¸ªè¿™æ ·çš„å˜é‡ï¼Œéƒ½æ˜¯intç±»å‹çš„ï¼Œä¸€å…±åˆšå¥½8å­—èŠ‚ã€‚<br>åœ¨SimpleSection.cé‡Œåœ¨è°ƒç”¨â€printfâ€çš„æ—¶å€™ï¼Œç”¨åˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡â€%d\nâ€,å®ƒæ˜¯ä¸€ç§åªè¯»æ•°æ®ï¼Œæ‰€ä»¥è¢«æ”¾åˆ°äº†â€.rodataâ€æ®µã€‚<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92l6sfdb3j21ei0kmmzk.jpg" alt=""></p>
<h3 id="BSSæ®µ-bss"><a href="#BSSæ®µ-bss" class="headerlink" title="BSSæ®µ(.bss)"></a>BSSæ®µ(.bss)</h3><p>.bssæ®µå­˜æ”¾çš„æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡ã€‚.bssæ®µä¸å ç£ç›˜ç©ºé—´ã€‚<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f92l7ea9guj21eo0ao0ti.jpg" alt=""></p>
<h3 id="å­—ç¬¦ä¸²è¡¨ï¼ˆ-strtabï¼‰"><a href="#å­—ç¬¦ä¸²è¡¨ï¼ˆ-strtabï¼‰" class="headerlink" title="å­—ç¬¦ä¸²è¡¨ï¼ˆ.strtabï¼‰"></a>å­—ç¬¦ä¸²è¡¨ï¼ˆ.strtabï¼‰</h3><p>åœ¨ELFæ–‡ä»¶ä¸­ï¼Œä¼šç”¨åˆ°å¾ˆå¤šå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚èŠ‚åï¼Œå˜é‡åç­‰ã€‚æ‰€ä»¥ELFå°†æ‰€æœ‰çš„å­—ç¬¦ä¸²é›†ä¸­æ”¾åˆ°ä¸€ä¸ªè¡¨é‡Œï¼Œæ¯ä¸€ä¸ªå­—ç¬¦ä¸²ä»¥â€™\0â€™åˆ†éš”ï¼Œç„¶åä½¿ç”¨å­—ç¬¦ä¸²åœ¨è¡¨ä¸­çš„åç§»æ¥å¼•ç”¨å­—ç¬¦ä¸²ã€‚<br>æ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92l7t2tyrj20k903fgm5.jpg" alt=""><br>é‚£ä¹ˆåç§»ä¸ä»–ä»¬å¯¹ç”¨çš„å­—ç¬¦ä¸²å¦‚ä¸‹è¡¨:<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92l81n2y1j20k7043jrs.jpg" alt=""><br>è¿™æ ·åœ¨ELFä¸­å¼•ç”¨å­—ç¬¦ä¸²åªéœ€è¦ç»™å‡ºä¸€ä¸ªæ•°ç»„ä¸‹æ ‡å³å¯ã€‚å­—ç¬¦ä¸²è¡¨åœ¨ELFä¹Ÿä»¥æ®µçš„å½¢å¼ä¿å­˜ï¼Œå¸¸è§çš„æ®µåä¸ºâ€.strtabâ€æˆ–â€.shstrtabâ€ã€‚è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²è¡¨åˆ†åˆ«ä¸ºå­—ç¬¦ä¸²è¡¨(String Table)å’Œæ®µè¡¨å­—ç¬¦ä¸²è¡¨(Header String Table)ï¼Œå­—ç¬¦ä¸²è¡¨ä¿å­˜çš„æ˜¯æ™®é€šçš„å­—ç¬¦ä¸²ï¼Œè€Œæ®µè¡¨å­—ç¬¦ä¸²è¡¨ç”¨æ¥ä¿å­˜æ®µè¡¨ä¸­ç”¨åˆ°çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚æ®µåã€‚</p>
<h3 id="ç¬¦å·è¡¨ï¼ˆ-symtabï¼‰"><a href="#ç¬¦å·è¡¨ï¼ˆ-symtabï¼‰" class="headerlink" title="ç¬¦å·è¡¨ï¼ˆ.symtabï¼‰"></a>ç¬¦å·è¡¨ï¼ˆ.symtabï¼‰</h3><p>åœ¨é“¾æ¥çš„è¿‡ç¨‹ä¸­éœ€è¦æŠŠå¤šä¸ªä¸åŒçš„ç›®æ ‡æ–‡ä»¶åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸åŒçš„ç›®æ ‡æ–‡ä»¶ç›¸äº’ä¹‹é—´ä¼šå¼•ç”¨å˜é‡å’Œå‡½æ•°ã€‚åœ¨é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å‡½æ•°å’Œå˜é‡ç»Ÿç§°ä¸ºç¬¦å·ï¼Œå‡½æ•°åå’Œå˜é‡åå°±æ˜¯ç¬¦å·åã€‚<br>æ¯ä¸€ä¸ªç›®æ ‡æ–‡ä»¶ä¸­éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„ç¬¦å·è¡¨(System Table)ï¼Œè¿™ä¸ªè¡¨é‡Œçºªå½•äº†ç›®æ ‡æ–‡ä»¶æ‰€ç”¨åˆ°çš„æ‰€æœ‰ç¬¦å·ã€‚æ¯ä¸ªå®šä¹‰çš„ç¬¦å·éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„å€¼ï¼Œå«åšç¬¦å·å€¼(Symbol Value)ï¼Œå¯¹äºå˜é‡å’Œå‡½æ•°ï¼Œç¬¦å·å€¼å°±æ˜¯å®ƒä»¬çš„åœ°å€ã€‚<br>ç¬¦å·è¡¨æ˜¯ä¸€ä¸ªElf32_Sym(32ä½)çš„æ•°ç»„ï¼Œæ¯ä¸ªElf32_Symå¯¹åº”ä¸€ä¸ªç¬¦å·ã€‚è¿™ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ä¸‹æ ‡ä¸º0çš„å…ƒç´ ä¸ºæ— æ•ˆçš„â€æœªå®šä¹‰â€ç¬¦å·ã€‚<br>ä»–ä»¬çš„å®šä¹‰å¦‚ä¸‹ï¼š<br><img src="http://ww1.sinaimg.cn/mw690/8b331ee1gw1f92l8p5639j20ku06t768.jpg" alt=""></p>
<p><strong>ç¬¦å·ç±»å‹å’Œç»‘å®šä¿¡æ¯(st_info)</strong><br>è¯¥æˆå‘˜çš„ä½4ä½æ ‡è¯†ç¬¦å·çš„ç±»å‹(Symbol Type)ï¼Œé«˜28ä½æ ‡è¯†ç¬¦å·ç»‘å®šä¿¡æ¯(Symbol Binding)ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92l9hsyp1j20kf04rwf9.jpg" alt=""><br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92l9o0v6dj20k907575x.jpg" alt=""><br><strong>ç¬¦å·æ‰€åœ¨æ®µ(st_shndx)</strong><br>å¦‚æœç¬¦å·å®šä¹‰åœ¨æœ¬ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆå‘˜è¡¨ç¤ºç¬¦å·æ‰€åœ¨æ®µåœ¨æ®µè¡¨ä¸­çš„ä¸‹è¡¨ï¼Œä½†æ˜¯å¦‚æœç¬¦å·ä¸æ˜¯å®šä¹‰åœ¨æœ¬ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œæˆ–è€…å¯¹äºæœ‰äº›ç‰¹æ®Šç¬¦å·ï¼Œsh_shndxçš„å€¼æœ‰äº›ç‰¹æ®Šã€‚å¦‚ä¸‹ï¼š<br><img src="http://ww3.sinaimg.cn/mw690/8b331ee1gw1f92la2n675j20kk07dq4r.jpg" alt=""></p>
<p><strong>ç¬¦å·å€¼(st_value)</strong><br>æ¯ä¸ªç¬¦å·éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å€¼ã€‚ä¸»è¦åˆ†ä¸‹é¢å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li>å¦‚æœç¬¦å·ä¸æ˜¯â€COMMONâ€ç±»å‹çš„(å³st_shndxä¸ä¸ºSHN_COMMON)ï¼Œåˆ™st_valueè¡¨ç¤ºè¯¥ç¬¦å·åœ¨æ®µä¸­çš„åç§»ï¼Œå³ç¬¦å·æ‰€å¯¹åº”çš„å‡½æ•°æˆ–å˜é‡ä½äºç”±st_shndxæŒ‡å®šçš„æ®µï¼Œåç§»st_valueçš„ä½ç½®ã€‚æ¯”å¦‚SimpleSectionä¸­çš„â€func1â€ï¼Œâ€mainâ€å’Œâ€global_init_varâ€ã€‚</li>
<li>åœ¨ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œå¦‚æœç¬¦å·æ˜¯â€COMMONâ€ç±»å‹(å³st_shndxä¸ºSHN_COMMON)ï¼Œåˆ™st_valueè¡¨ç¤ºè¯¥ç¬¦å·çš„å¯¹é½å±æ€§ã€‚æ¯”å¦‚SimleSectionä¸­çš„â€global_uninit_varâ€ã€‚</li>
<li>åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œst_valueè¡¨ç¤ºç¬¦å·çš„è™šæ‹Ÿåœ°å€ã€‚</li>
</ul>
<p>ä¸‹å›¾ä¸ºä½¿ç”¨readelfå·¥å…·æ¥æŸ¥çœ‹ELFæ–‡ä»¶çš„ç¬¦å·:<br><img src="http://ww3.sinaimg.cn/mw690/8b331ee1gw1f92lb4pncvj21jm0rgtea.jpg" alt=""><br>æ¯”å¦‚ï¼ŒNum13è¡ŒæŒ‡çš„æ˜¯ç¬¦å·è¡¨ä¸­çš„ç¬¬13ä¸ªå…ƒç´ ï¼Œç¬¦å·åä¸ºmainï¼Œå®ƒæ˜¯å‡½æ•°ç±»å‹ï¼Œå®šä¹‰åœ¨ç¬¬ä¸€ä¸ªæ®µï¼ˆå³.textæ®µï¼‰çš„ç¬¬001båç§»å¤„ï¼Œå¤§å°ä¸º64å­—èŠ‚ã€‚</p>
<h3 id="é‡å®šä½è¡¨-rel-text"><a href="#é‡å®šä½è¡¨-rel-text" class="headerlink" title="é‡å®šä½è¡¨(.rel.text)"></a>é‡å®šä½è¡¨(.rel.text)</h3><p>SimpleSection.oä¸­æœ‰ä¸€ä¸ªå«â€.rel.textâ€çš„æ®µï¼Œå®ƒçš„ç±»å‹(sh_type)ä¸ºâ€SHT_RELâ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªé‡å®šä½è¡¨ã€‚é“¾æ¥å™¨åœ¨å¤„ç†ç›®æ ‡æ–‡ä»¶æ—¶ï¼Œéœ€è¦å¯¹ç›®æ ‡æ–‡ä»¶ä¸­çš„æŸäº›éƒ¨ä½è¿›è¡Œé‡å®šä½ï¼Œå³ä»£ç æ®µå’Œæ•°æ®ä¸­ä¸­é‚£äº›ç»å¯¹åœ°å€å¼•ç”¨çš„ä½ç½®ã€‚å¯¹äºæ¯ä¸ªéœ€è¦é‡å®šä½çš„ä»£ç æ®µæˆ–æ•°æ®æ®µï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„é‡å®šä½è¡¨ã€‚æ¯”å¦‚â€.rel.textâ€å°±æ˜¯é’ˆå¯¹â€.textâ€çš„é‡å®šä½è¡¨ï¼Œâ€.rel.dataâ€å°±æ˜¯é’ˆå¯¹â€.dataâ€çš„é‡å®šä½è¡¨ã€‚</p>
<hr>
<h2 id="é™æ€é“¾æ¥"><a href="#é™æ€é“¾æ¥" class="headerlink" title="é™æ€é“¾æ¥"></a>é™æ€é“¾æ¥</h2><p>è¿™èŠ‚ä»¥ä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶ä¸ºä¾‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/* a.c */</div><div class="line">extern int shared;</div><div class="line">int main()&#123;</div><div class="line">    int a = 100;</div><div class="line">    swap(&amp;a,&amp;shared);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/* b.c */</div><div class="line">int shared = 1;</div><div class="line">void swap(int* a, int* b)&#123;</div><div class="line">    *a ^= *b ^= *a ^= *b;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬æœ‰ä¸¤ä¸ªç›®æ ‡æ–‡ä»¶æ—¶ï¼Œå¦‚ä½•å°†ä»–ä»¬é“¾æ¥èµ·æ¥å½¢æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Ÿ<br>å¯¹äºå¤šä¸ªè¾“å…¥ç›®æ ‡æ–‡ä»¶ï¼Œé“¾æ¥å™¨å¦‚ä½•å°†å®ƒä»¬çš„å„ä¸ªæ®µåˆå¹¶åˆ°è¾“å‡ºæ–‡ä»¶ï¼Ÿè¾“å‡ºæ–‡ä»¶ä¸­çš„ç©ºé—´å¦‚ä½•æ›´é…ç»™è¾“å…¥æ–‡ä»¶ï¼Ÿ<br>ä¸‹å›¾ä¸ºç°åœ¨é“¾æ¥å™¨é‡‡ç”¨çš„ç©ºé—´åˆ†é…ç­–ç•¥ã€‚<br><img src="http://ww1.sinaimg.cn/mw690/8b331ee1gw1f92lhyc2ugj2124138dkb.jpg" alt=""></p>
<p>æ•´ä¸ªé“¾æ¥è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ ç©ºé—´ä¸åœ°å€åˆ†é… æ‰«ææ‰€æœ‰çš„è¾“å…¥ç›®æ ‡æ–‡ä»¶ï¼Œå¹¶ä¸”è·å¾—å®ƒä»¬çš„å„ä¸ªæ®µçš„é•¿åº¦ã€å±æ€§å’Œä½ç½®ï¼Œå¹¶ä¸”å°†è¾“å…¥ç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¸­æ‰€æœ‰çš„ç¬¦å·å®šä¹‰å’Œç¬¦å·å¼•ç”¨æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªå…¨å±€ç¬¦å·è¡¨ä¸­ã€‚</li>
<li>ç¬¬äºŒæ­¥ ç¬¦å·è§£æä¸é‡å®šä½ ä½¿ç”¨ç¬¬ä¸€æ­¥ä¸­æ”¶é›†åˆ°çš„ä¿¡æ¯ï¼Œè¯»å–è¾“å…¥æ–‡ä»¶ä¸­æ®µçš„æ•°æ®ã€é‡å®šä½ä¿¡æ¯ï¼Œå¹¶ä¸”è¿›è¡Œç¬¦å·è§£æä¸é‡å®šä½ã€è°ƒæ•´ä»£ç ä¸­çš„åœ°å€ç­‰</li>
</ul>
<p>ä½¿ç”¨ldé“¾æ¥å™¨å°†â€a.oâ€å’Œâ€b.oâ€é“¾æ¥èµ·æ¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ld a.o b.o -e main -o ab</div></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹é“¾æ¥å‰åå„ä¸ªæ®µçš„å±æ€§<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f92ljdpqkgj21b418244f.jpg" alt=""><br>VMAè¡¨ç¤ºè™šæ‹Ÿåœ°å€ï¼ŒLMAè¡¨ç¤ºåŠ è½½åœ°å€ï¼Œæ­£å¸¸æƒ…å†µä¸‹è¿™ä¸¤ä¸ªå€¼åº”è¯¥ä¸€æ ·ã€‚</p>
<p>æ•´ä¸ªé“¾æ¥è¿‡ç¨‹å‰åï¼Œç›®æ ‡æ–‡ä»¶å„æ®µçš„åˆ†é…ã€ç¨‹åºè™šæ‹Ÿåœ°å€:<br><img src="http://ww1.sinaimg.cn/mw690/8b331ee1gw1f92ljxvmqmj21hq10ygo3.jpg" alt=""><br>åœ¨Linuxä¸‹ï¼ŒELFå¯æ‰§è¡Œæœªè§é»˜è®¤ä»åœ°å€0x08048000å¼€å§‹åˆ†é…ã€‚</p>
<h3 id="ç¬¦å·è§£æä¸é‡å®šä½"><a href="#ç¬¦å·è§£æä¸é‡å®šä½" class="headerlink" title="ç¬¦å·è§£æä¸é‡å®šä½"></a>ç¬¦å·è§£æä¸é‡å®šä½</h3><p>ç¼–è¯‘å™¨åœ¨å°†â€a.câ€ç¼–è¯‘æˆæŒ‡ä»¤æ—¶ï¼Œå®ƒå¦‚ä½•è®¿é—®â€sharedâ€å˜é‡ï¼Ÿå¦‚ä½•è°ƒç”¨â€swapâ€å‡½æ•°ï¼Ÿ<br><strong>é‡å®šä½è¡¨(Relocation Tabel)</strong>ä¸“é—¨ç”¨æ¥ä¿å­˜ä¸é‡å®šä½ç›¸å…³çš„ä¿¡æ¯ï¼Œé“¾æ¥å™¨æ ¹æ®å®ƒçŸ¥é“å“ªäº›æŒ‡ä»¤æ—¶è¦è¢«è°ƒæ•´çš„ï¼Œä»¥åŠå¦‚ä½•è°ƒæ•´ã€‚<br>å¯¹äº32ä½çš„Intel x86ç³»åˆ—å¤„ç†å™¨æ¥è¯´ï¼Œé‡å®šä½è¡¨çš„ç»“æ„æ˜¯ä¸€ä¸ªElf_32Relç»“æ„çš„æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å¯¹åº”ä¸€ä¸ªé‡å®šä½å…¥å£ã€‚å®šä¹‰å¦‚ä¸‹ï¼š<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f92lm64qwqj21j00kwtec.jpg" alt=""></p>
<p>å¯ä»¥ä½¿ç”¨objdumpæ¥æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„é‡å®šä½è¡¨ï¼š<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f92lmerm9rj20oa0bu3za.jpg" alt=""></p>
<p>å°†â€a.oâ€çš„ä»£ç æ®µåæ±‡ç¼–å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“â€œsharedâ€çš„åœ°å€ï¼Œæš‚æ—¶æŠŠåœ°å€0çœ‹åšâ€sharedâ€çš„åœ°å€ã€‚<br>0xE8æ˜¯ä¸€æ¡è¿‘å€ç›¸å¯¹ä½ç§»è°ƒç”¨æŒ‡ä»¤ï¼Œåé¢4ä¸ªå­—èŠ‚å°±æ˜¯è¢«è°ƒç”¨å‡½æ•°çš„ç›¸å¯¹äºè°ƒç”¨æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åç§»é‡ã€‚<br>æ­¤å¤„â€swapâ€å‡½æ•°çš„åœ°å€æ˜¯0x2b-4=0x27,å¯ä»¥çœ‹å‡º0xfffffffcä¹Ÿæ˜¯ä¸€ä¸ªä¸´æ—¶åœ°å€ã€‚<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92lmrq7o2j21900yagpl.jpg" alt=""></p>
<p><strong>æŒ‡ä»¤ä¿®æ­£æ–¹å¼</strong><br><img src="http://ww3.sinaimg.cn/mw690/8b331ee1gw1f92lngo4gzj21iu0fsjuq.jpg" alt=""></p>
<p>æŒ‡ä»¤ä¿®å¤çš„ç»“æœ<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92lnnaqsej21d411ydlb.jpg" alt=""></p>
<hr>
<h2 id="å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½ä¸è¿›ç¨‹"><a href="#å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½ä¸è¿›ç¨‹" class="headerlink" title="å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½ä¸è¿›ç¨‹"></a>å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½ä¸è¿›ç¨‹</h2><p>ç¨‹åºæ‰§è¡Œæ—¶æ‰€éœ€è¦çš„æŒ‡ä»¤å’Œæ•°æ®å¿…éœ€åœ¨å†…å­˜ä¸­æ‰èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚<br>é¡µæ˜ å°„å°†å†…å­˜å’Œæ‰€æœ‰ç£ç›˜ä¸­çš„æ•°æ®å’ŒæŒ‡ä»¤æŒ‰ç…§â€œé¡µï¼ˆPageï¼‰â€ä¸ºå•ä½åˆ’åˆ†æˆè‹¥å¹²ä¸ªé¡µï¼Œä»¥åæ‰€æœ‰çš„è£…è½½å’Œæ“ä½œçš„å•ä½å°±æ˜¯é¡µã€‚</p>
<p>è¿›ç¨‹çš„å»ºç«‹éœ€è¦åšä¸‹é¢ä¸‰ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´</li>
<li>è¯»å–å¯æ‰§è¡Œæ–‡ä»¶å¤´ï¼Œå¹¶ä¸”å»ºç«‹è™šæ‹Ÿç©ºé—´ä¸å¯æ‰§è¡Œæ–‡ä»¶çš„æ˜ å°„å…³ç³»ã€‚</li>
<li>å°†CPUçš„æŒ‡ä»¤å¯„å­˜å™¨è®¾ç½®æˆå¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£åœ°å€ï¼Œå¯åŠ¨è¿è¡Œã€‚</li>
</ul>
<p>å¯¹äºç¬¬2æ­¥ï¼Œå½“æ“ä½œç³»ç»Ÿæ•è·åˆ°ç¼ºé¡µé”™è¯¯æ—¶ï¼Œå®ƒåº”è¯¥çŸ¥é“ç¨‹åºå½“å‰æ‰€éœ€çš„é¡µåœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å“ªä¸€ä¸ªä½ç½®ã€‚<br>è¿™ç§æ˜ å°„å…³ç³»æ˜¯ä¿å­˜åœ¨æ“ä½œç³»ç»Ÿå†…éƒ¨çš„ä¸€ä¸ªæ•°æ®ç»“æ„<strong>VMA</strong>ã€‚<br>ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œæ“ä½œç³»ç»Ÿåˆ›å»ºè¿›ç¨‹åï¼Œä¼šåœ¨è¿›ç¨‹ç›¸åº”çš„æ•°æ®ç»“æ„ä¸­è®¾ç½®æœ‰ä¸€ä¸ª.textæ®µçš„VMAï¼šå®ƒåœ¨è™šæ‹Ÿç©ºé—´ä¸­çš„åœ°å€ä¸º0x08048000~0x08049000ï¼Œå®ƒå¯¹åº”ELFæ–‡ä»¶ä¸­åç§»ä¸º0çš„.textï¼Œå®ƒçš„å±æ€§ä¸ºåªè¯»ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å±æ€§ã€‚<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f92lokbzk3j20wi0lo0u7.jpg" alt=""></p>
<p><strong>é¡µé”™è¯¯</strong><br>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç¨‹åºçš„å…¥å£åœ°å€ä¸º0x08048000ï¼Œå½“CPUå¼€å§‹æ‰“ç®—æ‰§è¡Œè¿™ä¸ªåœ°å€çš„æŒ‡ä»¤æ—¶ï¼Œå‘ç°é¡µé¢0x08048000~0x08049000ï¼ˆè™šæ‹Ÿåœ°å€ï¼‰æ˜¯ä¸ªç©ºé¡µé¢ï¼Œäºæ˜¯å®ƒå°±è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªé¡µé”™è¯¯ã€‚CPUå°†æ§åˆ¶æƒäº¤ç»™æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿå°†æŸ¥è¯¢è™šæ‹Ÿç©ºé—´ä¸å¯æ‰§è¡Œæ–‡ä»¶çš„æ˜ å°„å…³ç³»è¡¨ï¼Œæ‰¾åˆ°ç©ºé¡µé¢æ‰€åœ¨çš„VMAï¼Œè®¡ç®—ç›¸åº”çš„é¡µé¢åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„åç§»ï¼Œç„¶ååœ¨ç‰©ç†å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªç‰©ç†é¡µé¢ï¼Œå°†è¿›ç¨‹ä¸­è¯¥è™šæ‹Ÿé¡µä¸åˆ†é…çš„ç‰©ç†é¡µä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œç„¶åæŠŠæ§åˆ¶æƒå†è¿˜ç»™è¿›ç¨‹ï¼Œè¿›ç¨‹ä»åˆšæ‰é¡µé”™è¯¯çš„ä½ç½®é‡æ–°å¼€å§‹æ‰§è¡Œã€‚</p>
<h3 id="é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾-1"><a href="#é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾-1" class="headerlink" title="é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾"></a>é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾</h3><p>ä»¥ä¸‹é¢çš„ç¨‹åºä¸ºä¾‹ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">ä½¿ç”¨é™æ€é“¾æ¥çš„æ–¹å¼å°†å…¶ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼š</div><div class="line">$gcc -static SectionMapping.c -o SectionMapping.elf</div><div class="line">**/</div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">    &#123;</div><div class="line">        sleep(<span class="number">1000</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸‹é¢çš„elfæ–‡ä»¶è¢«é‡æ–°åˆ’åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œæœ‰ä¸€äº›æ®µè¢«å½’å…¥å¯è¯»å¯æ‰§è¡Œçš„ï¼Œä»–ä»¬è¢«ç»Ÿä¸€æ˜ å°„åˆ°ä¸€ä¸ªCODE VMAï¼›å¦ä¸€éƒ¨åˆ†æ®µæ˜¯å¯è¯»å¯å†™çš„ï¼Œå®ƒä»¬è¢«æ˜ å°„åˆ°äº†DATA VMAï¼›è¿˜æœ‰ä¸€äº›æ®µåœ¨ç¨‹åºæ‰§è¡Œæ—¶æ²¡æœ‰ç”¨ï¼Œæ‰€ä»¥ä¸éœ€è¦æ˜ å°„ã€‚<br>ELFä¸Linuxè¿›ç¨‹è™šæ‹Ÿç©ºé—´æ˜ å°„å…³ç³»ï¼ˆä¸€ä¸ªå¸¸è§è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ï¼‰å¦‚ä¸‹å›¾ã€‚<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92lpqlsm9j212y1fkaem.jpg" alt=""></p>
<h4 id="ç¨‹åºå¤´è¡¨-Program-Header-Table"><a href="#ç¨‹åºå¤´è¡¨-Program-Header-Table" class="headerlink" title="ç¨‹åºå¤´è¡¨(Program Header Table)"></a>ç¨‹åºå¤´è¡¨(Program Header Table)</h4><p>ç”¨æ¥ä¿å­˜â€œSegmentâ€çš„ä¿¡æ¯,æè¿°äº†ELFæ–‡ä»¶è¯¥å¦‚ä½•è¢«æ“ä½œç³»ç»Ÿæ˜ å°„åˆ°è™šæ‹Ÿç©ºé—´ã€‚å› ä¸ºELFç›®æ ‡æ–‡ä»¶ä¸éœ€è¦è¢«è£…è½½ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ç¨‹åºå¤´è¡¨ï¼Œè€ŒELFçš„å¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«åº“æ–‡ä»¶éƒ½æœ‰ã€‚<br>ä½¿ç”¨readelfæŸ¥çœ‹ç¨‹åºå¤´è¡¨ã€‚<br><img src="http://ww1.sinaimg.cn/mw690/8b331ee1gw1f92lreiga6j21380me0x3.jpg" alt=""></p>
<p>è·Ÿæ®µè¡¨ç»“æ„ä¸€æ ·ï¼Œç¨‹åºå¤´è¡¨ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œå…¶ç»“æ„ä½“ç”¨Elf32_Phdrè¡¨ç¤ºã€‚<br>ä¸‹è¡¨æ˜¯Elf32_Phdrç»“æ„çš„å„ä¸ªæˆå‘˜çš„åŸºæœ¬å«ä¹‰ã€‚<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f92lrncz74j21jw0vwgtx.jpg" alt=""></p>
<h3 id="å †å’Œæ ˆ"><a href="#å †å’Œæ ˆ" class="headerlink" title="å †å’Œæ ˆ"></a>å †å’Œæ ˆ</h3><p>VMAé™¤äº†è¢«ç”¨æ¥æ˜ å°„å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å„ä¸ªâ€segmentâ€ä»¥å¤–ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡ä½¿ç”¨VMAæ¥å¯¹è¿›ç¨‹çš„åœ°å€ç©ºé—´è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬å †å’Œæ ˆã€‚<br>åœ¨Linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹â€/procâ€æ¥æŸ¥çœ‹è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´åˆ†å¸ƒï¼š<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f92ltj5czaj21120hkwi3.jpg" alt=""><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿›ç¨‹ä¸­æœ‰5ä¸ªVMA,åªæœ‰å‰ä¸¤ä¸ªæ˜¯æ˜ å°„åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä¸¤ä¸ªSegmentã€‚å¦å¤–ä¸‰ä¸ªæ®µçš„æ–‡ä»¶æ‰€åœ¨è®¾å¤‡ä¸»è®¾å¤‡å·åŠæ–‡ä»¶èŠ‚ç‚¹å·éƒ½æ˜¯0ï¼Œåˆ™è¡¨ç¤ºä»–ä»¬æ²¡æœ‰æ˜ å°„åˆ°æ–‡ä»¶ä¸­ï¼Œè¿™ç§VMAå«åšåŒ¿åè™šæ‹Ÿå†…å­˜åŒºåŸŸã€‚å¦å¤–æœ‰ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„VMAå«â€œvdsoâ€ï¼Œå®ƒçš„åœ°å€å·²ç»ä½äºå†…æ ¸ç©ºé—´äº†ï¼ˆå³å¤§äº0xC0000000çš„åœ°å€ï¼‰ï¼Œäº‹å®ä¸Šå®ƒæ˜¯ä¸€ä¸ªå†…æ ¸çš„æ¨¡å—ï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡è®¿é—®è¿™ä¸ªVMAæ¥è·Ÿå†…æ ¸è¿›è¡Œä¸€äº›é€šä¿¡ã€‚<br>æ“ä½œç³»ç»Ÿé€šè¿‡ç»™è¿›ç¨‹ç©ºé—´åˆ’åˆ†å‡ºä¸€ä¸ªä¸ªVMAæ¥ç®¡ç†è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ï¼›åŸºæœ¬åŸåˆ™æ˜¯å°†ç›¸åŒæƒé™å±æ€§çš„ã€æœ‰ç›¸åŒæ˜ åƒæ–‡ä»¶çš„æ˜ å°„æˆä¸€ä¸ªVMAã€‚</p>
<hr>
<h2 id="åŠ¨æ€é“¾æ¥"><a href="#åŠ¨æ€é“¾æ¥" class="headerlink" title="åŠ¨æ€é“¾æ¥"></a>åŠ¨æ€é“¾æ¥</h2><p>ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">/* Lib.h */</div><div class="line">#ifndef LIB_H</div><div class="line">#define LIB_H</div><div class="line">void foobar(int i);</div><div class="line">#endif</div><div class="line"></div><div class="line">/* Lib.c */</div><div class="line">#include &lt;stdio.h&gt;</div><div class="line">void foobar(int i)&#123;</div><div class="line">    printf(&quot;Printing from Lib.so %d\n&quot;,i);</div><div class="line">    sleep(-1);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/* Program1.c */</div><div class="line">#include &quot;Lib.h&quot;</div><div class="line">int main()&#123;</div><div class="line">    foobar(1);</div><div class="line">    return;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/* Program2.c */</div><div class="line">#include &quot;Lib.h&quot;</div><div class="line">int main()&#123;</div><div class="line">    foobar(2);</div><div class="line">    return;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å°†Lib.cç¼–è¯‘æˆä¸€ä¸ªå…±äº«å¯¹è±¡æ–‡ä»¶ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$gcc</span> <span class="_">-f</span>PIC -shared -o Lib.so Lib.c</div></pre></td></tr></table></figure>
<p>åˆ†åˆ«ç¼–è¯‘é“¾æ¥Program1.cå’ŒProgram2.cï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$gcc</span> -o Program1 Program1.c ./Lib.so</div></pre></td></tr></table></figure></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$gcc</span> -o Program2 Program2.c ./Lib.so</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†å¸ƒï¼š<br><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f92lywp140j20zm0n0grl.jpg" alt=""><br>ä¸Šå›¾ä¸­çš„ld-2.6.soå®é™…ä¸Šæ˜¯Linuxä¸‹çš„åŠ¨æ€é“¾æ¥å™¨ï¼Œå®ƒä¸æ™®é€šå…±äº«å¯¹è±¡ä¸€æ ·è¢«æ˜ å°„åˆ°äº†è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œåœ¨ç³»ç»Ÿå¼€å§‹è¿è¡Œprogram1ä¹‹å‰ï¼Œé¦–å…ˆä¼šæŠŠæ§åˆ¶æƒäº¤ç»™åŠ¨æ€é“¾æ¥å™¨ï¼Œç”±å®ƒå®Œæˆæ‰€æœ‰çš„åŠ¨æ€é“¾æ¥å·¥ä½œä»¥åå†æŠŠæ§åˆ¶æƒäº¤ç»™program1,ç„¶åå¼€å§‹æ‰§è¡Œã€‚</p>
<p>é€šè¿‡readelfæŸ¥çœ‹Lib.soçš„è£…è½½å±æ€§ï¼š<br><img src="http://ww1.sinaimg.cn/mw690/8b331ee1gw1f9320c9v7lj214q0q8776.jpg" alt=""><br>ä¸æ™®é€šç¨‹åºä¸åŒçš„æ˜¯ï¼ŒåŠ¨æ€é“¾æ¥æ¨¡å—çš„è£…è½½åœ°å€æ˜¯ä»åœ°å€0x00000000å¼€å§‹çš„ï¼Œè¿™ä¸ªåœ°å€æ˜¯æ— æ•ˆçš„ï¼Œå…±äº«å¯¹è±¡çš„æœ€ç»ˆè£…è½½åœ°å€åœ¨ç¼–è¯‘æ—¶æ—¶ä¸ç¡®å®šçš„ï¼Œè€Œæ˜¯åœ¨è£…è½½æ—¶ï¼Œè£…è½½å™¨æ ¹æ®å½“å‰åœ°å€ç©ºé—´çš„ç©ºå‰æƒ…å†µï¼ŒåŠ¨æ€åˆ†é…ä¸€å—è¶³å¤Ÿå¤§å°çš„è™šæ‹Ÿåœ°å€ç©ºé—´ç»™ç›¸åº”çš„å…±äº«å¯¹è±¡ã€‚</p>
<h3 id="åœ°å€æ— å…³ä»£ç -PIC"><a href="#åœ°å€æ— å…³ä»£ç -PIC" class="headerlink" title="åœ°å€æ— å…³ä»£ç (PIC)"></a>åœ°å€æ— å…³ä»£ç (PIC)</h3><p>è£…è½½æ—¶é‡å®šä½æ˜¯è§£å†³åŠ¨æ€æ¨¡å—ä¸­æœ‰ç»å¯¹åœ°å€å¼•ç”¨çš„æ–¹æ³•ä¹‹ä¸€ï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹æ˜¯æŒ‡ä»¤éƒ¨åˆ†æ— æ³•åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«ï¼Œè¿™æ ·å°±å¤±å»äº†åŠ¨æ€é“¾æ¥èŠ‚çœå†…å­˜çš„ä¸€å¤§ä¼˜åŠ¿ã€‚æˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•è§£å†³å…±äº«å¯¹è±¡æŒ‡ä»¤ä¸­å¯¹ç»å¯¹åœ°å€çš„é‡å®šä½é—®é¢˜ã€‚å…¶å®æˆ‘ä»¬çš„ç›®çš„å¾ˆç®€å•ï¼Œå¸Œæœ›ç¨‹åºæ¨¡å—ä¸­å…±äº«çš„æŒ‡ä»¤éƒ¨åˆ†åœ¨è£…è½½æ—¶ä¸éœ€è¦å› ä¸ºè£…è½½åœ°å€çš„æ”¹å˜è€Œæ”¹å˜ï¼Œæ‰€ä»¥å®ç°çš„åŸºæœ¬æ€æƒ³å°±æ˜¯æŠŠæŒ‡ä»¤ä¸­é‚£äº›éœ€è¦è¢«ä¿®æ”¹çš„éƒ¨åˆ†åˆ†ç¦»å‡ºæ¥ï¼Œè·Ÿæ•°æ®éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·æŒ‡ä»¤éƒ¨åˆ†å°±å¯ä»¥ä¿æŒä¸å˜ï¼Œè€Œæ•°æ®éƒ¨åˆ†å¯ä»¥åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚</p>
<p>æ¨¡å—ä¸­å„ç§ç±»å‹çš„åœ°å€å¼•ç”¨æ–¹å¼å¦‚ä¸‹å›¾ï¼š<br><img src="http://ww3.sinaimg.cn/mw690/8b331ee1gw1f9321f0xmjj20hg0go76x.jpg" alt=""></p>
<h4 id="å…¨å±€åç§»è¡¨-GOT"><a href="#å…¨å±€åç§»è¡¨-GOT" class="headerlink" title="å…¨å±€åç§»è¡¨(GOT)"></a>å…¨å±€åç§»è¡¨(GOT)</h4><p>ç”¨äºæ¨¡å—é—´æ•°æ®è®¿é—®ï¼Œåœ¨æ•°æ®æ®µé‡Œå»ºç«‹ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨æ¨¡å—å˜é‡çš„æŒ‡é’ˆæ•°ç»„ã€‚å½“ä»£ç éœ€è¦å¼•ç”¨è¯¥å…¨å±€å˜é‡æ—¶ï¼Œå¯ä»¥é€šè¿‡GOTä¸­ç›¸å¯¹ç”¨çš„é¡¹é—´æ¥å¼•ç”¨ï¼Œå®ƒçš„åŸºæœ¬æœºåˆ¶å¦‚ä¸‹å›¾ã€‚<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f9321to16sj214w10qwgd.jpg" alt=""><br>å½“æŒ‡ä»¤ä¸­éœ€è¦è®¿é—®å˜é‡bæ—¶ï¼Œç¨‹åºä¼šå…ˆæ‰¾åˆ°GOTï¼Œç„¶åæ ¹æ®GOTä¸­å˜é‡æ‰€å¯¹åº”çš„é¡¹æ‰¾åˆ°å˜é‡çš„ç›®æ ‡åœ°å€ã€‚æ¯ä¸ªå˜é‡éƒ½å¯¹åº”ä¸€ä¸ª4å­—èŠ‚çš„åœ°å€ï¼Œé“¾æ¥å™¨åœ¨è£…è½½æ¨¡å—çš„æ—¶å€™ä¼šæŸ¥æ‰¾æ¯ä¸ªå˜é‡æ‰€åœ¨çš„åœ°å€ï¼Œç„¶åå¡«å……GOTä¸­çš„å„ä¸ªé¡¹ï¼Œä»¥ç¡®ä¿æ¯ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€æ­£ç¡®ã€‚ç”±äºGOTæœ¬èº«æ˜¯æ”¾åœ¨æ•°æ®æ®µçš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åœ¨æ¨¡å—è£…è½½æ—¶è¢«ä¿®æ”¹ï¼Œå¹¶ä¸”æ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥æœ‰ç‹¬ç«‹çš„å‰¯æœ¬ï¼Œç›¸äº’ä¸å—å½±å“ã€‚</p>
<h4 id="å»¶è¿Ÿç»‘å®š-PLT"><a href="#å»¶è¿Ÿç»‘å®š-PLT" class="headerlink" title="å»¶è¿Ÿç»‘å®š(PLT)"></a>å»¶è¿Ÿç»‘å®š(PLT)</h4><p>åŠ¨æ€é“¾æ¥ä¸‹å¯¹äºå…¨å±€å’Œé™æ€çš„æ•°æ®è®¿é—®éƒ½è¦è¿›è¡Œå¤æ‚çš„GOTå®šä½ï¼Œç„¶åé—´æ¥å¯»å€ï¼›å¯¹äºæ¨¡å—é—´çš„è°ƒç”¨ä¹Ÿè¦å…ˆå®šä½GOTï¼Œç„¶åå†è¿›è¡Œé—´æ¥è·³è½¬ã€‚ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨éƒ½è¦è¿›è¡Œä¸€æ¬¡é“¾æ¥å·¥ä½œï¼Œä¼šå¯»æ‰¾å¹¶è£…è½½æ‰€éœ€çš„å…±äº«å¯¹è±¡ï¼Œç„¶åè¿›è¡Œç¬¦å·æŸ¥æ‰¾åœ°å€é‡å®šä½ç­‰å·¥ä½œï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œç¨‹åºçš„è¿è¡Œé€Ÿåº¦å¿…å®šä¼šå‡æ…¢ã€‚</p>
<p>å»¶è¿Ÿç»‘å®šçš„å®ç°<br>å‡½æ•°ç¬¬ä¸€æ¬¡è¢«ç”¨åˆ°æ—¶æ‰è¿›è¡Œç»‘å®šï¼ˆç¬¦å·æŸ¥æ‰¾ã€é‡å®šä½ç­‰ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°åˆ™ä¸è¿›è¡Œç»‘å®šã€‚</p>
<p>GOT ä½äº .got.plt section ä¸­ï¼Œè€Œ PLT ä½äº .plt sectionä¸­ã€‚<br>GOT ä¿å­˜äº†ç¨‹åºä¸­æ‰€è¦è°ƒç”¨çš„å‡½æ•°çš„åœ°å€ï¼Œè¿è¡Œä¸€å¼€æ—¶å…¶è¡¨é¡¹ä¸ºç©ºï¼Œä¼šåœ¨è¿è¡Œæ—¶å®æ—¶çš„æ›´æ–°è¡¨é¡¹ã€‚ä¸€ä¸ªç¬¦å·è°ƒç”¨åœ¨ç¬¬ä¸€æ¬¡æ—¶ä¼šè§£æå‡ºç»å¯¹åœ°å€æ›´æ–°åˆ° GOT ä¸­ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨æ—¶å°±ç›´æ¥æ‰¾åˆ° GOT è¡¨é¡¹æ‰€å­˜å‚¨çš„å‡½æ•°åœ°å€ç›´æ¥è°ƒç”¨äº†ã€‚<br>printfï¼ˆï¼‰å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹å›¾<br><img src="http://ww3.sinaimg.cn/mw690/8b331ee1gw1f9322tt0r1j20le0dhjss.jpg" alt=""></p>
<h3 id="åŠ¨æ€é“¾æ¥çš„ç›¸å…³ç»“æ„"><a href="#åŠ¨æ€é“¾æ¥çš„ç›¸å…³ç»“æ„" class="headerlink" title="åŠ¨æ€é“¾æ¥çš„ç›¸å…³ç»“æ„"></a>åŠ¨æ€é“¾æ¥çš„ç›¸å…³ç»“æ„</h3><h4 id="interpæ®µ"><a href="#interpæ®µ" class="headerlink" title=".interpæ®µ"></a>.interpæ®µ</h4><p>åœ¨åŠ¨æ€é“¾æ¥çš„ELFå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸“é—¨çš„æ®µå«åšâ€.interpâ€æ®µã€‚é‡Œé¢ä¿å­˜çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè®°å½•æ‰€éœ€åŠ¨æ€é“¾æ¥å™¨çš„è·¯å¾„ã€‚<br>ä»ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼ŒAndroidç”¨çš„åŠ¨æ€é“¾æ¥å™¨æ˜¯linker<br><img src="http://ww1.sinaimg.cn/mw690/8b331ee1gw1f9323mnszoj21j805itco.jpg" alt=""></p>
<h4 id="dynamicæ®µ"><a href="#dynamicæ®µ" class="headerlink" title=".dynamicæ®µ"></a>.dynamicæ®µ</h4><p>è¿™ä¸ªæ®µé‡Œä¿å­˜äº†åŠ¨æ€é“¾æ¥å™¨æ‰€éœ€è¦çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚ä¾èµ–å“ªäº›å…±äº«å¯¹è±¡ã€åŠ¨æ€é“¾æ¥ç¬¦å·è¡¨çš„ä½ç½®ã€åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨çš„ä½ç½®ã€å…±äº«å¯¹è±¡åˆå§‹åŒ–ä»£ç çš„åœ°å€ç­‰ã€‚<br>.dynamicæ®µé‡Œä¿å­˜çš„ä¿¡æ¯æœ‰ç‚¹åƒELFæ–‡ä»¶å¤´ã€‚<br>.dynamicæ®µçš„ç»“æ„æ˜¯ç”±Elf32_Dynç»„æˆçš„æ•°ç»„ã€‚<br>Elf32_Dynç»“æ„ç”±ä¸€ä¸ªç±»å‹å€¼åŠ ä¸Šä¸€ä¸ªé™„åŠ çš„æ•°å€¼æˆ–æŒ‡é’ˆï¼Œå¯¹äºä¸åŒçš„ç±»å‹ï¼Œåé¢é™„åŠ çš„æ•°å€¼æˆ–è€…æŒ‡é’ˆæœ‰ç€ä¸åŒçš„å«ä¹‰ã€‚<br><img src="http://ww3.sinaimg.cn/mw690/8b331ee1gw1f932414wnzj21ii0syq9p.jpg" alt=""></p>
<h4 id="åŠ¨æ€ç¬¦å·è¡¨-dynsym"><a href="#åŠ¨æ€ç¬¦å·è¡¨-dynsym" class="headerlink" title="åŠ¨æ€ç¬¦å·è¡¨(.dynsym)"></a>åŠ¨æ€ç¬¦å·è¡¨(.dynsym)</h4><p>ä¸ºäº†è¡¨ç¤ºåŠ¨æ€é“¾æ¥æ¨¡å—ä¹‹é—´çš„ç¬¦å·å¯¼å…¥å¯¼å‡ºå…³ç³»ï¼ŒELFä¸“é—¨æœ‰ä¸€ä¸ªå«åšåŠ¨æ€ç¬¦å·è¡¨çš„æ®µç”¨æ¥ä¿å­˜è¿™äº›ä¿¡æ¯ã€‚<br>ä¸â€.symtabâ€ä¸åŒçš„æ˜¯ï¼Œâ€.dynsymâ€åªä¿å­˜äº†ä¸åŠ¨æ€é“¾æ¥ç›¸å…³çš„ç¬¦å·ï¼Œå¯¹äºé‚£äº›æ¨¡å—å†…éƒ¨çš„ç¬¦å·ï¼Œæ¯”å¦‚æ¨¡å—ç§æœ‰å˜é‡åˆ™ä¸ä¿å­˜ã€‚å¾ˆå¤šæ—¶å€™åŠ¨æ€é“¾æ¥æ¨¡å—åŒæ—¶æ‹¥æœ‰â€.dynsymâ€å’Œâ€.symtabâ€ä¸¤ä¸ªè¡¨ï¼Œâ€.symtabâ€ä¸­å¾€å¾€ä¿å­˜äº†æ‰€æœ‰ç¬¦å·ï¼ŒåŒ…æ‹¬â€.dynsymâ€ä¸­çš„ç¬¦å·ã€‚</p>
<h4 id="åŠ¨æ€ç¬¦å·å­—ç¬¦ä¸²è¡¨-dynstr"><a href="#åŠ¨æ€ç¬¦å·å­—ç¬¦ä¸²è¡¨-dynstr" class="headerlink" title="åŠ¨æ€ç¬¦å·å­—ç¬¦ä¸²è¡¨(.dynstr)"></a>åŠ¨æ€ç¬¦å·å­—ç¬¦ä¸²è¡¨(.dynstr)</h4><p>åœ¨åŠ¨æ€é“¾æ¥æ—¶ç”¨äºä¿å­˜ç¬¦å·åçš„å­—ç¬¦ä¸²è¡¨ã€‚</p>
<h4 id="ç¬¦å·å“ˆå¸Œè¡¨-hash"><a href="#ç¬¦å·å“ˆå¸Œè¡¨-hash" class="headerlink" title="ç¬¦å·å“ˆå¸Œè¡¨(.hash)"></a>ç¬¦å·å“ˆå¸Œè¡¨(.hash)</h4><p>ç”±äºåŠ¨æ€é“¾æ¥ä¸‹ï¼Œéœ€è¦åœ¨ç¨‹åºè¿è¡Œæ—¶æŸ¥æ‰¾ç¬¦å·ï¼Œä¸ºäº†åŠ å¿«ç¬¦å·çš„æŸ¥æ‰¾è¿‡ç¨‹ï¼Œå¾€å¾€è¿˜æœ‰è¾…åŠ©çš„ç¬¦å·å¥½æˆè¡¨ã€‚<br>ç”¨readelfæŸ¥çœ‹elfæ–‡ä»¶çš„åŠ¨æ€ç¬¦å·è¡¨åŠå®ƒçš„å“ˆå¸Œè¡¨ã€‚<br><img src="http://ww3.sinaimg.cn/mw690/8b331ee1gw1f9324ovvklj211g0n6af4.jpg" alt=""></p>
<h3 id="åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨"><a href="#åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨" class="headerlink" title="åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨"></a>åŠ¨æ€é“¾æ¥é‡å®šä½è¡¨</h3><p>åœ¨åŠ¨æ€é“¾æ¥ä¸­ï¼Œå¯¼å…¥ç¬¦å·çš„åœ°å€åœ¨è¿è¡Œæ—¶æ‰ç¡®å®šï¼Œæ‰€ä»¥éœ€è¦åœ¨è¿è¡Œæ—¶å°†è¿™äº›å¯¼å…¥ç¬¦å·çš„å¼•ç”¨ä¿®æ­£ï¼Œå³éœ€è¦é‡å®šä½ã€‚</p>
<p>â€œ.rel.dynâ€æ®µå¯¹æ•°æ®å¼•ç”¨çš„ä¿®æ­£ï¼Œå®ƒæ‰€ä¿®æ­£çš„ä½ç½®ä½äºâ€.gotâ€ä»¥åŠæ•°æ®æ®µï¼›<br>â€œ.rel.pltâ€æ®µå¯¹å‡½æ•°å¼•ç”¨ä¿®æ­£ï¼Œå®ƒæ‰€ä¿®æ­£çš„ä½ç½®ä½äºâ€.got.pltâ€ã€‚<br>ç”¨readelfæ¥æŸ¥çœ‹ä¸€ä¸ªåŠ¨æ€é“¾æ¥çš„æ–‡ä»¶çš„é‡å®šä½è¡¨ï¼š<br><img src="http://ww3.sinaimg.cn/mw690/8b331ee1gw1f93258e2hrj21i00ue7a1.jpg" alt=""><br>R_386_JUMP_SLOTå’ŒR_386_GLOB_DATè¿™ä¸¤ä¸ªç±»å‹çš„é‡å®šä½å…¥å£è¡¨ç¤ºï¼Œè¢«ä¿®æ­£çš„ä½ç½®åªéœ€è¦ç›´æ¥å¡«å…¥ç¬¦å·åœ°å€å³å¯ã€‚<br>æ¯”å¦‚ï¼Œprintfè¿™ä¸ªé‡å®šä½å…¥å£ï¼Œå®ƒçš„ç±»å‹ä¸ºR_386_JUMP_SLOTï¼Œå®ƒçš„åç§»ä¸º0x000015d8ï¼Œå®ƒä½äºâ€.got.pltâ€ä¸­ï¼Œä¸‹å›¾ä¸ºå…¶ç»“æ„ã€‚<br><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1f9325hfyr7j213q0zitfq.jpg" alt=""><br>å½“é“¾æ¥å™¨éœ€è¦è¿›è¡Œé‡å®šä½æ—¶ï¼Œå®ƒå…ˆæŸ¥æ‰¾â€printfâ€çš„åœ°å€ï¼Œâ€œprintfâ€ä½äºlibc.soä¸­ã€‚å‡è®¾é“¾æ¥å™¨åœ¨å…¨å±€ç¬¦å·è¡¨é‡Œé¢æ‰¾åˆ°â€printfâ€çš„åœ°å€ä¸º0x08801234,é‚£ä¹ˆé“¾æ¥å™¨å°±ä¼šå°†è¿™ä¸ªåœ°å€å¡«å…¥åˆ°â€.got.pltâ€ä¸­åç§»ä¸º0x000015d8çš„ä½ç½®ä¸­å»ï¼Œä»è€Œå®ç°äº†åœ°å€çš„é‡å®šä½ã€‚<br>R_386_GLOB_DATæ˜¯å¯¹â€.gotâ€çš„é‡å®šä½ï¼Œå®ƒè·ŸR_386_JUMP_SLOTçš„åšæ³•ä¸€æ ·ã€‚</p>
<hr>
<h2 id="hookæ–¹æ¡ˆçš„ä¸€ç§å®ç°æ–¹æ¡ˆ"><a href="#hookæ–¹æ¡ˆçš„ä¸€ç§å®ç°æ–¹æ¡ˆ" class="headerlink" title="hookæ–¹æ¡ˆçš„ä¸€ç§å®ç°æ–¹æ¡ˆ"></a>hookæ–¹æ¡ˆçš„ä¸€ç§å®ç°æ–¹æ¡ˆ</h2><p>å…·ä½“å®ç°æ¥è‡ªAndrey Petrovçš„<a href="http://shadowwhowalks.blogspot.com/2013/01/android-hacking-hooking-system.html" target="_blank" rel="external">blog</a>. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">#include &quot;linker.h&quot;  // get it from bionic</div><div class="line">static unsigned elfhash(const char *_name)  </div><div class="line">&#123;  </div><div class="line">  const unsigned char *name = (const unsigned char *) _name;  </div><div class="line">  unsigned h = 0, g;  </div><div class="line">  while(*name) &#123;  </div><div class="line">    h = (h &lt;&lt; 4) + *name++;  </div><div class="line">    g = h &amp; 0xf0000000;  </div><div class="line">    h ^= g;  </div><div class="line">    h ^= g &gt;&gt; 24;  </div><div class="line">  &#125;  </div><div class="line">  return h;  </div><div class="line">&#125;  </div><div class="line">static Elf32_Sym *soinfo_elf_lookup(soinfo *si, unsigned hash, const char *name)  </div><div class="line">&#123;  </div><div class="line">  Elf32_Sym *s;  </div><div class="line">  Elf32_Sym *symtab = si-&gt;symtab;  </div><div class="line">  const char *strtab = si-&gt;strtab;  </div><div class="line">  unsigned n;  </div><div class="line">  n = hash % si-&gt;nbucket;  </div><div class="line">  for(n = si-&gt;bucket[hash % si-&gt;nbucket]; n != 0; n = si-&gt;chain[n])&#123;  </div><div class="line">    s = symtab + n;  </div><div class="line">    if(strcmp(strtab + s-&gt;st_name, name)) continue;  </div><div class="line">      return s;  </div><div class="line">    &#125;  </div><div class="line">  return NULL;  </div><div class="line">&#125;  </div><div class="line"></div><div class="line">int hook_call(char *soname, char *symbol, unsigned newval) &#123;  </div><div class="line"> soinfo *si = NULL;  </div><div class="line"> Elf32_Rel *rel = NULL;  </div><div class="line"> Elf32_Sym *s = NULL;   </div><div class="line"> unsigned int sym_offset = 0;  </div><div class="line"> if (!soname || !symbol || !newval)  </div><div class="line">    return 0;  </div><div class="line"> si = (soinfo*) dlopen(soname, 0);  </div><div class="line"> if (!si)  </div><div class="line">  return 0;  </div><div class="line"> s = soinfo_elf_lookup(si, elfhash(symbol), symbol);  </div><div class="line"> if (!s)  </div><div class="line">   return 0;  </div><div class="line"> sym_offset = s - si-&gt;symtab;  </div><div class="line"> rel = si-&gt;plt_rel;  </div><div class="line"> /* walk through reloc table, find symbol index matching one we&apos;ve got */  </div><div class="line"> for (int i = 0; i &lt; si-&gt;plt_rel_count; i++, rel++) &#123;  </div><div class="line">  unsigned type = ELF32_R_TYPE(rel-&gt;r_info);  </div><div class="line">  unsigned sym = ELF32_R_SYM(rel-&gt;r_info);  </div><div class="line">  unsigned reloc = (unsigned)(rel-&gt;r_offset + si-&gt;base);  </div><div class="line">  unsigned oldval = 0;  </div><div class="line">  if (sym_offset == sym) &#123;  </div><div class="line">   switch(type) &#123;  </div><div class="line">     case R_ARM_JUMP_SLOT:  </div><div class="line">        /* we do not have to read original value, but it would be good   </div><div class="line">          idea to make sure it contains what we are looking for */  </div><div class="line">        oldval = *(unsigned*) reloc;  </div><div class="line">        *((unsigned*)reloc) = newval;  </div><div class="line">        return 1;  </div><div class="line">     default:  </div><div class="line">        return 0;  </div><div class="line">   &#125;  </div><div class="line">  &#125;  </div><div class="line"> &#125;  </div><div class="line"> return 0;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç”¨æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hook_call(&quot;libandroid_runtime.so&quot;, &quot;connect&quot;, &amp;my_connect);</div></pre></td></tr></table></figure></p>
<p>1.è°ƒç”¨dlopenæ‹¿åˆ°soçš„å¥æŸ„,å¾—åˆ°soinfo,å®ƒåŒ…å«äº†ç¬¦å·è¡¨ã€é‡å®šä½è¡¨ã€pltè¡¨ç­‰ä¿¡æ¯ã€‚<br>2.æŸ¥æ‰¾éœ€è¦hookçš„å‡½æ•°çš„ç¬¦å·ï¼Œå¾—åˆ°å®ƒåœ¨ç¬¦å·è¡¨ä¸­çš„ç´¢å¼•ã€‚å…·ä½“å®ç°æ˜¯soinfo_elf_lookupå‡½æ•°ã€‚</p>
<p><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1f932uud83bj207r088mxj.jpg" alt=""></p>
<p>bucketæ•°ç»„åŒ…å«nbucketä¸ªé¡¹ç›®ï¼Œchainæ•°ç»„åŒ…å«nchainä¸ªé¡¹ç›®ï¼Œä¸‹æ ‡éƒ½æ˜¯ä»0å¼€å§‹ã€‚bucketå’Œchainä¸­éƒ½ä¿å­˜äº†ç¬¦å·è¡¨çš„ç´¢å¼•ã€‚chainè¡¨é¡¹å’Œç¬¦å·è¡¨å­˜åœ¨å¯¹åº”ã€‚ç¬¦å·è¡¨é¡¹çš„æ•°ç›®åº”è¯¥å’Œnchainç›¸ç­‰ï¼Œæ‰€ä»¥ç¬¦å·è¡¨çš„ç´¢å¼•ä¹Ÿå¯ä»¥ç”¨æ¥é€‰å–chainè¡¨é¡¹ã€‚å“ˆå¸Œå‡½æ•°èƒ½å¤Ÿæ¥å—ç¬¦å·åå¹¶è¿”å›ä¸€ä¸ªå¯ä»¥ç”¨æ¥è®¡ç®—bucketçš„ç´¢å¼•ã€‚å¦‚æœå“ˆå¸Œå‡½æ•°é’ˆå¯¹æŸä¸ªåå­—è¿”å›äº†æ•°å€¼xï¼Œåˆ™bucket[x%nbucket]ç»™å‡ºäº†ä¸€ä¸ªç´¢å¼•yï¼Œè¯¥ç´¢å¼•å¯ç”¨äºç¬¦å·è¡¨ï¼Œä¹Ÿå¯ç”¨äºchainè¡¨ã€‚å¦‚æœè¯¥ç¬¦å·è¡¨é¡¹ä¸æ˜¯æ‰€éœ€è¦çš„ï¼Œé‚£ä¹ˆchain[y]åˆ™ç»™å‡ºäº†å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„ä¸‹ä¸€ä¸ªç¬¦å·è¡¨é¡¹ã€‚æˆ‘ä»¬å¯ä»¥æ²¿ç€chainé“¾ä¸€ç›´æœç´¢ï¼Œç›´åˆ°æ‰€é€‰ä¸­çš„ç¬¦å·è¡¨é¡¹åŒ…å«äº†æ‰€éœ€è¦çš„ç¬¦å·ï¼Œæˆ–è€…chainé¡¹ä¸­åŒ…å«å€¼STN_UNDEFã€‚</p>
<p> 3.éå†pltè¡¨ï¼Œç›´åˆ°åŒ¹é…ç¬¬2æ­¥ä¸­æ‰¾åˆ°çš„ç¬¦å·ç´¢å¼•ã€‚<br> å¦‚æœæ˜¯JUMP_SLOTç±»å‹ï¼ˆå‡½æ•°è°ƒç”¨ï¼‰ï¼Œæ›¿æ¢ä¸ºæ–°çš„ç¬¦å·åœ°å€ï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ã€‚</p>
<hr>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li>ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹</li>
<li>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹</li>
<li><a href="http://shadowwhowalks.blogspot.com/2013/01/android-hacking-hooking-system.html" target="_blank" rel="external">Andrey Petrovâ€™s blog</a></li>
<li><a href="https://www.apriorit.com/dev-blog/181-elf-hook" target="_blank" rel="external">Redirecting functions in shared ELF libraries</a></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ä»£ç æµè§ˆå·¥å…·OpenGrok]]></title>
      <url>https://The-Coderz.github.io/2016/12/28/2016-12-25-%E4%BB%A3%E7%A0%81%E6%B5%8F%E8%A7%88%E5%B7%A5%E5%85%B7OpenGrok/</url>
      <content type="html"><![CDATA[<p><a href="https://opengrok.github.io/OpenGrok/" target="_blank" rel="external">OpenGrok</a>æ˜¯ä¸€æ¬¾å¼ºå¤§çš„è·¨å¹³å°ä»£ç é˜…è¯»å·¥å…·ï¼Œè®¸å¤šåœ¨çº¿æºç æŸ¥çœ‹ç½‘ç«™éƒ½æ˜¯ä½¿ç”¨å®ƒæ¥æ­å»ºçš„ï¼Œæ¯”å¦‚è‘—åçš„Androidåœ¨çº¿æºç æŸ¥çœ‹ç½‘ç«™<a href="http://androidxref.com/" target="_blank" rel="external">androidxref</a>.</p>
<p><br><br><br><br><br></p>
<h2 id="OpenGrokç‰¹æ€§"><a href="#OpenGrokç‰¹æ€§" class="headerlink" title="OpenGrokç‰¹æ€§"></a>OpenGrokç‰¹æ€§</h2><p>OpenGrok æä¾›å¦‚ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li><p>1.å¿«é€Ÿæœç´¢ä»£ç çš„å¼•æ“</p>
<p>  æœç´¢å…¨æ–‡ã€å®šä¹‰ã€ç¬¦å·ã€æ–‡ä»¶è·¯å¾„å’Œä¿®æ”¹å†å²</p>
<p>  æœç´¢ä»»æ„æŒ‡å®šå­ç›®å½•ï¼ˆåˆ†å±‚æœç´¢ï¼‰</p>
<p>  å¢é‡æ›´æ–°ç´¢å¼•æ–‡ä»¶</p>
</li>
<li><p>2.æ”¯æŒç±»ä¼¼ Google çš„æŸ¥è¯¢è¯­æ³•ï¼Œæ¯”å¦‚ path:Makefile defs:target</p>
<p>  æœç´¢æ—¥æœŸèŒƒå›´å†…ä¿®æ”¹çš„æ–‡ä»¶</p>
<p>  æ”¯æŒä½¿ç”¨é€šé…ç¬¦æœç´¢ï¼Œå¦‚ * è¡¨ç¤ºå¤šä¸ªå­—ç¬¦ï¼Œ? è¡¨ç¤ºå•ä¸ªå­—ç¬¦</p>
<p>  åœ¨æœç´¢ç»“æœä¸­å±•ç¤ºåŒ¹é…è¡Œ</p>
</li>
<li><p>3.ä¸€ä¸ª Web åªè¯»ç‰ˆçš„ç‰ˆæœ¬å†å²æŸ¥çœ‹ç•Œé¢</p>
<p>  æ–‡ä»¶çš„ä¿®æ”¹æ—¥å¿—</p>
<p>  æ–‡ä»¶åœ¨ä¸¤ä¸ªç‰ˆæœ¬é—´çš„ diff</p>
<p>  æ–‡ä»¶å¤¹çš„å†å²è®°å½•</p>
</li>
<li><p>4.å¸¦è¯­æ³•é«˜äº®çš„äº¤å‰å¼•ç”¨æ˜¾ç¤ºï¼Œå¯ä»¥ä½¿ç”¨ CSS è‡ªå®šä¹‰æ ·å¼</p>
<p>  å¯ä»¥å¼€å‘æ’ä»¶æ”¯æŒæ–°çš„è¯­è¨€å’Œç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</p>
<p>  å·²ç»æ”¯æŒçš„è¯­è¨€ï¼š <a href="https://link.zhihu.com/?target=https%3A//github.com/OpenGrok/OpenGrok/wiki/Supported-Languages-and-Formats" target="_blank" rel="external">Supported Languages and Formats</a></p>
<p>  å·²ç»æ”¯æŒçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼š<a href="https://link.zhihu.com/?target=https%3A//github.com/OpenGrok/OpenGrok/wiki/Supported-Revision-Control-Systems" target="_blank" rel="external">Supported Revision Control Systems</a></p>
</li>
</ul>
<p><br><br><br><br><br></p>
<h2 id="åœ¨macOSå¹³å°æ­å»ºOpenGrok"><a href="#åœ¨macOSå¹³å°æ­å»ºOpenGrok" class="headerlink" title="åœ¨macOSå¹³å°æ­å»ºOpenGrok"></a>åœ¨macOSå¹³å°æ­å»ºOpenGrok</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>1.å®‰è£…tomcat</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ brew install tomcat</div></pre></td></tr></table></figure>
<p>2.å®‰è£…ctags</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ brew install ctags</div></pre></td></tr></table></figure>
<p>3.å®‰è£…OpenGrok</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ wget -O - http://java.net/projects/opengrok/downloads/download/opengrok-0.12.1.tar.gz | tar xvz</div></pre></td></tr></table></figure>
<h3 id="å¼€å¯tomcat"><a href="#å¼€å¯tomcat" class="headerlink" title="å¼€å¯tomcat"></a>å¼€å¯tomcat</h3><p>æ–¹æ³•1ï¼šcdåˆ°tomcatæ‰€åœ¨ç›®å½•ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œ<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ catalina start </div><div class="line">$ open http://localhost:8080/<span class="built_in">source</span></div></pre></td></tr></table></figure></p>
<p>æ–¹æ³•2ï¼šä¸‹è½½macOSä¸‹çš„GUIç¨‹åº<a href="https://www.macupdate.com/app/mac/18706/tomcat-controller" target="_blank" rel="external">TomcatController</a><br>é…ç½®tomcatæ‰€åœ¨ç›®å½•ã€‚<br><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fb2vmdecmpj217c0i6gpb.jpg" alt=""></p>
<h3 id="å¼€å¯openGroké¡¹ç›®"><a href="#å¼€å¯openGroké¡¹ç›®" class="headerlink" title="å¼€å¯openGroké¡¹ç›®"></a>å¼€å¯openGroké¡¹ç›®</h3><p>openGrokå…¶å®å°±æ˜¯ä¸€ä¸ªwebapp<br><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fb2vobc954j21kw09saf1.jpg" alt=""></p>
<h3 id="å¯¼å…¥é¡¹ç›®"><a href="#å¯¼å…¥é¡¹ç›®" class="headerlink" title="å¯¼å…¥é¡¹ç›®"></a>å¯¼å…¥é¡¹ç›®</h3><p>æ¯”å¦‚å¯¼å…¥ffmpegï¼Œåœ¨opengrokç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªlocal_srcæ–‡ä»¶å¤¹ï¼ŒæŠŠffmpegæ–‡ä»¶å¤¹é€šè¿‡è½¯å¼•ç”¨çš„æ–¹å¼é“¾åˆ°local_srcä¸‹çš„srcç›®å½•ï¼Œè¿™æ ·å°±èƒ½è®©opengrokæ‰¾åˆ°ffmpegçš„ä»£ç äº†ã€‚<br><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fb2vt7txidj21kw0cx42c.jpg" alt=""></p>
<h3 id="å»ºç«‹ç´¢å¼•"><a href="#å»ºç«‹ç´¢å¼•" class="headerlink" title="å»ºç«‹ç´¢å¼•"></a>å»ºç«‹ç´¢å¼•</h3><p><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fb2vtrtcuwj216g03476a.jpg" alt=""></p>
<h3 id="æ‰“å¼€æµè§ˆå™¨"><a href="#æ‰“å¼€æµè§ˆå™¨" class="headerlink" title="æ‰“å¼€æµè§ˆå™¨"></a>æ‰“å¼€æµè§ˆå™¨</h3><p>è®¿é—® <a href="http://localhost:8080/source" target="_blank" rel="external">http://localhost:8080/source</a> å°±èƒ½çœ‹åˆ°ä»£ç äº†ã€‚<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1fb2vuwcxfej21gc0aw3zw.jpg" alt=""></p>
<p><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fb2vv6s7voj21kw1d3aoa.jpg" alt=""></p>
<hr>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://blog.simplypatrick.com/2015/01/16/opengrok-on-mac-osx/" target="_blank" rel="external">http://blog.simplypatrick.com/2015/01/16/opengrok-on-mac-osx/</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/24369747" target="_blank" rel="external">https://zhuanlan.zhihu.com/p/24369747</a></p>
<p><a href="https://github.com/OpenGrok/OpenGrok/wiki/Features" target="_blank" rel="external">https://github.com/OpenGrok/OpenGrok/wiki/Features</a></p>
<p><a href="http://bytesthink.com/blog/?p=184" target="_blank" rel="external">http://bytesthink.com/blog/?p=184</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[jpegç¼–ç å­¦ä¹ ç¬”è®°]]></title>
      <url>https://The-Coderz.github.io/2016/12/28/2016-12-24-jpeg%E7%BC%96%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      <content type="html"><![CDATA[<p>å„ç§å›¾ç‰‡æ ¼å¼ç›®çš„æ˜¯åœ¨ç½‘ç»œä¼ è¾“å’Œå­˜å‚¨çš„æ—¶å€™ä½¿ç”¨æ›´å°‘çš„å­—èŠ‚ï¼Œå³èµ·åˆ°å‹ç¼©çš„ä½œç”¨ã€‚åœ¨å›¾ç‰‡æ ¼å¼è§£ç åï¼Œæ— è®ºå›¾ç‰‡çš„æ ¼å¼ï¼Œå›¾ç‰‡æ•°æ®éƒ½æ˜¯åƒç´ æ•°ç»„ã€‚<br>æœ¬æ–‡å°†å°è¯•é€šè¿‡JPEGè¿™ç§å›¾ç‰‡ç¼–ç æ ¼å¼çš„å­¦ä¹ ï¼Œäº†è§£å›¾ç‰‡ç¼–ç çš„ç§˜å¯†ã€‚</p>
<p><br><br><br><br><br></p>
<h2 id="JPEGç®€ä»‹"><a href="#JPEGç®€ä»‹" class="headerlink" title="JPEGç®€ä»‹"></a>JPEGç®€ä»‹</h2><p>ä¸€å¼ 100X100å¤§å°çš„æ™®é€šå›¾ç‰‡ï¼Œå¦‚æœæœªç»å‹ç¼©ï¼Œå¤§æ¦‚åœ¨100<em>100</em>4*8bits=0.3MBå·¦å³,è¿™ä¹Ÿæ˜¯å›¾ç‰‡åœ¨å†…å­˜ä¸­å ç”¨çš„å†…å­˜å¤§å°ã€‚<br>é€šå¸¸JPEGæ–‡ä»¶ç›¸å¯¹äºåŸå§‹å›¾åƒ,èƒ½å¤Ÿå¾—åˆ°1/8çš„å‹ç¼©æ¯”ï¼Œå¦‚æ­¤é«˜çš„å‹ç¼©ç‡æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ</p>
<p>JPEGèƒ½å¤Ÿè·å¾—å¦‚æ­¤é«˜çš„å‹ç¼©æ¯”æ˜¯å› ä¸ºä½¿ç”¨äº†æœ‰æŸå‹ç¼©æŠ€æœ¯ï¼Œæ‰€è°“æœ‰æŸå‹ç¼©ï¼Œå°±æ˜¯æŠŠåŸå§‹æ•°æ®ä¸­ä¸é‡è¦çš„éƒ¨åˆ†å»æ‰ï¼Œä»¥ä¾¿å¯ä»¥ç”¨æ›´å°çš„ä½“ç§¯ä¿å­˜ã€‚</p>
<p>JPEGç¼–ç æ˜¯åŸºäºä¸¤ä¸ªideaï¼Œç¬¬ä¸€ä¸ªæ˜¯åŸºäºç›¸é‚»çš„åƒç´ ä¿¡æ¯æ˜¯ç›¸è¿‘çš„ï¼Œå³ç©ºé—´å†—ä½™æ€§ï¼Œå°½é‡å°‘è®°å½•é‡å¤çš„æ•°æ®æ¥è¾¾åˆ°å‹ç¼©çš„æ•ˆæœã€‚ç¬¬äºŒä¸ªæ˜¯åŸºäºå›¾åƒä¿¡å·çš„é¢‘è°±ç‰¹æ€§ï¼Œå›¾åƒåŒ…å«å„ç§é¢‘ç‡ï¼Œå¤§éƒ¨åˆ†ä¸ºä½é¢‘é¢‘è°±ï¼Œå°‘éƒ¨åˆ†ä¸ºé«˜é¢‘é¢‘è°±ã€‚å¯ä»¥ä¿ç•™åŒ…å«å›¾åƒä¿¡æ¯è¾ƒå¤šçš„ä½é¢‘é¢‘è°±ï¼Œèˆå»åŒ…å«å›¾åƒä¿¡æ¯è¾ƒå°‘çš„é«˜é¢‘é¢‘è°±ã€‚è€Œè¾¾åˆ°å›¾ç‰‡è´¨é‡æ²¡æœ‰å¯å¯Ÿè§‰çš„æŸä¼¤ï¼Œåˆèƒ½è¾¾åˆ°å‹ç¼©çš„æ•ˆæœã€‚è¿™ä¹Ÿè¯´æ˜äº†JPEGæ˜¯æœ‰æŸç¼–ç ã€‚</p>
<p><br><br><br><br><br></p>
<h2 id="JPEGçš„ç¼–ç è¿‡ç¨‹"><a href="#JPEGçš„ç¼–ç è¿‡ç¨‹" class="headerlink" title="JPEGçš„ç¼–ç è¿‡ç¨‹"></a>JPEGçš„ç¼–ç è¿‡ç¨‹</h2><p>ç¼–ç æµç¨‹å¦‚ä¸‹å›¾ï¼š<br><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1fb2c7jxxyaj20eg08d74o.jpg" alt="ç¼–ç æµç¨‹ç¤ºæ„å›¾"></p>
<p><br><br><br><br><br></p>
<h3 id="1-è‰²å½©ç©ºé—´è½¬æ¢"><a href="#1-è‰²å½©ç©ºé—´è½¬æ¢" class="headerlink" title="1.è‰²å½©ç©ºé—´è½¬æ¢"></a>1.è‰²å½©ç©ºé—´è½¬æ¢</h3><p>å°†RGBè‰²å½©ç©ºé—´è½¬æ¢åˆ°å…¶ä»–è‰²å½©ç©ºé—´ï¼Œæ¯”å¦‚<a href="https://en.wikipedia.org/wiki/YUV" target="_blank" rel="external">YUV</a>è‰²å½©ç©ºé—´ã€‚<br>å‡ºç°YUV,ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼Œä¸€ä¸ªæ˜¯ä¸ºäº†è®©å½©è‰²ä¿¡å·å…¼å®¹é»‘ç™½ç”µè§†æœºï¼Œå¦å¤–ä¸€ä¸ªåŸå› æ˜¯ä¸ºäº†å‡å°‘ä¼ è¾“çš„å¸¦å®½ã€‚<br>ä¸‹å›¾ä¸ºè€ç”µè§†åé¢çš„è‰²å·®æ¥å£ã€‚<br><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fb24juusowj206u046q3w.jpg" alt="ç”µè§†è‰²å·®æ¥å£"><br>YUVä¸­ï¼ŒYè¡¨ç¤ºäº®åº¦ï¼ŒUå’ŒVè¡¨ç¤ºè‰²åº¦ï¼Œæ€»ä¹‹å®ƒæ˜¯å°†RGBä¿¡å·è¿›è¡Œäº†ä¸€ç§å¤„ç†ï¼Œæ ¹æ®äººå¯¹äº®åº¦æ›´æ•æ„Ÿäº›ï¼Œå¢åŠ äº®åº¦çš„ä¿¡å·ï¼Œå‡å°‘é¢œè‰²çš„ä¿¡å·ï¼Œä»¥è¿™æ ·â€œæ¬ºéª—â€äººçš„çœ¼ç›çš„æ‰‹æ®µæ¥èŠ‚çœç©ºé—´ã€‚YUVçš„æ ¼å¼ä¹Ÿå¾ˆå¤šï¼Œä¸è¿‡å¸¸è§çš„å°±æ˜¯422å’Œ420æ ¼å¼ã€‚</p>
<p>ä¸‹å›¾ä¸º420æ ¼å¼ï¼Œæ¯å››ä¸ªYå…±ç”¨ä¸€ç»„UVåˆ†é‡ï¼Œæ¯ä¸ªYUVåˆ†é‡å’ŒRGBä¸€æ ·éƒ½ç”¨8ä½æ¥è¡¨ç¤ºï¼ŒYUVè‰²å½©ç©ºé—´å°±æ¯”RGBè‰²å½©ç©ºé—´æ‰€éœ€çš„å­˜å‚¨ç©ºé—´å°‘ä¸€åŠï¼Œæ•°æ®å°±è¢«å‹ç¼©åˆ°äº†ä¸€åŠã€‚<br><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1fb24kvqketj20aa04n3zt.jpg" alt="Y420"></p>
<p><br><br><br><br><br></p>
<h3 id="2-ç¦»æ•£ä½™å¼¦å˜æ¢DCT"><a href="#2-ç¦»æ•£ä½™å¼¦å˜æ¢DCT" class="headerlink" title="2.ç¦»æ•£ä½™å¼¦å˜æ¢DCT"></a>2.ç¦»æ•£ä½™å¼¦å˜æ¢DCT</h3><p>ç®€å•åœ°è¯´ï¼ŒDCTæ˜¯å‚…é‡Œå¶å˜æ¢çš„ä¸€ç§ï¼Œå˜æ¢åä¼šå¾—åˆ°ä¸€ä¸ªç³»æ•°ã€‚<br>æœ‰å…³DCTçš„è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹è¿™ä¸ª<a href="https://www.youtube.com/watch?v=Q2aEzeMDHMA" target="_blank" rel="external">è§†é¢‘</a>ã€‚</p>
<p>åœ¨JPEGå‹ç¼©è¿‡ç¨‹ä¸­ï¼Œç»è¿‡é¢œè‰²ç©ºé—´çš„è½¬æ¢ï¼Œæ¯ä¸€ä¸ªè‰²å€¼è¡¨ç¤ºæˆ8X8çš„å›¾åƒå—ï¼Œä¸‹å›¾ä¸ºä¸€ä¸ªè‰²å½©åŸŸå–æ ·å—ï¼Œè½¬åŒ–ä¸ºé¢‘ç‡åŸŸçš„DCTç³»æ•°å—ï¼š<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1fb24n45lgbj20gv03qq3u.jpg" alt="è½¬åŒ–ä¸ºé¢‘ç‡åŸŸçš„DCTç³»æ•°å—"></p>
<p>å›¾ç‰‡ç»è¿‡æ­¤æ­¥éª¤ä¼šè¾“å‡ºä¸€ä¸ªé¢‘ç‡ç³»æ•°çŸ©é˜µï¼Œå·¦ä¸Šçš„ç³»æ•°å¹…åº¦å€¼æœ€å¤§ï¼Œè¶Šå¾€å³ä¸‹ï¼Œç³»æ•°çš„å¹…åº¦å€¼è¶Šå°ï¼Œé¢‘ç‡è¶Šé«˜ã€‚å¤§éƒ¨åˆ†å›¾ç‰‡ä¿¡æ¯éƒ½åœ¨é¢‘ç‡åŸŸçŸ©é˜µå·¦ä¸ŠåŒºåŸŸï¼Œå³ä¸‹å‡ ä¹ä¸å«æœ‰å›¾ç‰‡ä¿¡æ¯ï¼Œç”šè‡³åªå«æ‚æ³¢ã€‚<br>æ³¨æ„ï¼šè½¬æ¢åçš„DCTç³»æ•°å—çŸ©é˜µ(x,y)å¤„çš„å€¼å¹¶ä¸å’Œè½¬æ¢å‰çš„é¢œè‰²ç©ºé—´çŸ©é˜µï¼ˆx,yï¼‰å¤„çš„åƒç´ å€¼ç›´æ¥å¯¹åº”ã€‚</p>
<p>è¿™ä¸€æ­¥éª¤æ²¡æœ‰å‹ç¼©ä½œç”¨ï¼Œå®ƒç›®çš„æ˜¯ä¸ºä¸‹ä¸€æ­¥éª¤æ‰¾ä½é¢‘å’Œé«˜é¢‘åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯æ‰¾å‡ºç•™ä¸‹çš„åŒºåŸŸå’Œèˆå»çš„åŒºåŸŸã€‚</p>
<p><br><br><br><br><br></p>
<h3 id="3-é‡åŒ–"><a href="#3-é‡åŒ–" class="headerlink" title="3.é‡åŒ–"></a>3.é‡åŒ–</h3><p>æ­¤æ­¥æ˜¯å°†ä¸Šæ­¥æ±‚å¾—çš„DCTç³»æ•°çš„ç®€åŒ–çš„è¿‡ç¨‹ï¼Œåˆ©ç”¨äººçœ¼å¯¹é«˜é¢‘éƒ¨åˆ†ä¸æ•æ„Ÿçš„ç‰¹æ€§æ¥èˆå»é«˜é¢‘éƒ¨åˆ†ã€‚<br>è¿™é‡Œæœ‰ä¸¤å¼ è¡¨åˆ†åˆ«å¯¹äº®åº¦å’Œè‰²åº¦åšé‡åŒ–å¤„ç†ã€‚</p>
<p>æ ‡å‡†äº®åº¦é‡åŒ–è¡¨ï¼š<br><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fb24qq7yq0j20sw0b8t9r.jpg" alt="æ ‡å‡†äº®åº¦é‡åŒ–è¡¨"></p>
<p>æ ‡å‡†è‰²åº¦é‡åŒ–è¡¨ï¼š<br><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fb24rftccuj20sy0b8gmn.jpg" alt="æ ‡å‡†è‰²åº¦é‡åŒ–è¡¨"></p>
<p>é‡åŒ–è¡¨æ˜¯æ§åˆ¶ JPEG å‹ç¼©æ¯”çš„å…³é”®ã€‚<br>DCTç³»æ•°çŸ©é˜µä¸­çš„ä¸åŒä½ç½®çš„å€¼ä»£è¡¨äº†å›¾åƒæ•°æ®ä¸­ä¸åŒé¢‘ç‡çš„åˆ†é‡ï¼Œè¿™ä¸¤å¼ è¡¨ä¸­çš„æ•°æ®æ˜¯æ ¹æ®äººçœ¼å¯¹ä¸åŒé¢‘ç‡çš„æ•æ„Ÿç¨‹åº¦çš„å·®åˆ«æ‰€ç§¯ç´¯ä¸‹çš„ç»éªŒåˆ¶å®šçš„ã€‚è¿™ä¸ªæ­¥éª¤é™¤æ‰äº†ä¸€äº›é«˜é¢‘é‡, æŸå¤±äº†å¾ˆå¤šç»†èŠ‚. ä½†äº‹å®ä¸Šäººçœ¼å¯¹é«˜ç©ºé—´é¢‘ç‡è¿œæ²¡æœ‰ä½é¢‘æ•æ„Ÿ.æ‰€ä»¥å¤„ç†åçš„è§†è§‰æŸå¤±å¾ˆå°ã€‚<br>å¦ä¸€ä¸ªé‡è¦åŸå› æ˜¯æ‰€æœ‰çš„å›¾ç‰‡çš„ç‚¹ä¸ç‚¹ä¹‹é—´ä¼šæœ‰ä¸€ä¸ªè‰²å½©è¿‡æ¸¡çš„è¿‡ç¨‹. å¤§é‡çš„å›¾è±¡ä¿¡æ¯è¢«åŒ…å«åœ¨ä½ç©ºé—´é¢‘ç‡ä¸­ã€‚ ç»è¿‡é‡åŒ–å¤„ç†å, åœ¨é«˜ç©ºé—´é¢‘ç‡æ®µ, å°†å‡ºç°å¤§é‡è¿ç»­çš„é›¶ã€‚</p>
<p>æŠŠä¸Šé¢çš„DCTç³»æ•°å—é€šè¿‡é‡åŒ–åçš„ç»“æœå¦‚ä¸‹å›¾ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ•°-26æ˜¯ç›´æµDCéƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€å—å›¾è±¡æ ·æœ¬çš„å¹³å‡å€¼ï¼ŒåŒ…å«äº†åŸå§‹8x8å›¾åƒå—ä¸­çš„å¾ˆå¤šèƒ½é‡ï¼Œå…¶ä½™çš„æ˜¯äº¤æµACéƒ¨åˆ†ã€‚<br>è®¡ç®—æ–¹æ³•ä¸ºï¼šé¢‘ç‡ç³»æ•°çŸ©é˜µçš„æ•°å€¼é™¤ä»¥å¯¹åº”é‡åŒ–è¡¨ä½ç½®ä¸Šçš„æ•°å€¼ï¼Œå¹¶å››èˆäº”å…¥åˆ°æœ€è¿‘çš„æ•´æ•°ã€‚<br><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1fb24usawejg20ie034t8o.gif" alt="é‡åŒ–è¿‡ç¨‹"></p>
<p>è§£ç çš„æ—¶å€™ï¼Œåé‡åŒ–æ­¥éª¤ä¼šä¹˜å›é‡åŒ–è¡¨ç›¸åº”å€¼ï¼Œä½†æ˜¯å››èˆäº”å…¥å¯¼è‡´ä½é¢‘æœ‰æ‰€æŸå¤±ï¼Œé«˜é¢‘0å­—æ®µè¢«èˆå¼ƒã€‚æ­¤æ­¥ä¸ºæœ‰æŸè¿ç®—ï¼Œä¼šå¯¼è‡´å›¾åƒè´¨é‡å˜ä½ã€‚æ‰€ä»¥è¯´JPEGæ˜¯æœ‰æŸç¼–ç ã€‚</p>
<p><br><br><br><br><br></p>
<h3 id="4-zig-zagæ¸¸ç¨‹ç¼–ç "><a href="#4-zig-zagæ¸¸ç¨‹ç¼–ç " class="headerlink" title="4.zig-zagæ¸¸ç¨‹ç¼–ç "></a>4.zig-zagæ¸¸ç¨‹ç¼–ç </h3><p>é‡åŒ–åçš„æ•°æ®è¿˜å¯ä»¥è¿›è¡Œç®€åŒ–ï¼Œæ›´å¤§ç¨‹åº¦çš„å»å‹ç¼©ã€‚<br><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1fb251cuevrj20fe0bq0tg.jpg" alt="zig-zagè¡¨"></p>
<p>æ ¹æ®ä¸Šé¢çš„zig-zagè¡¨é‡æ’æ•°æ®çš„è¿‡ç¨‹ï¼š<br><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1fb255f7vvsj208s05mq38.jpg" alt="zig-zagè¿‡ç¨‹"><br>æ ¹æ®ZigZagè¡¨çš„è§„åˆ™å¯¹é‡åŒ–åçš„æ•°æ®è¿›è¡Œé‡æ’åçš„ç»“æœä¸­å¯ä»¥çœ‹åˆ°å‡ºç°è¿ç»­çš„å¤šä¸ª0ï¼Œè¿™æ ·æœ‰åˆ©äºè¿›è¡Œæ¸¸ç¨‹ç¼–ç ã€‚</p>
<p><br><br><br><br><br></p>
<h3 id="5-èŒƒå¼Huffmanç¼–ç "><a href="#5-èŒƒå¼Huffmanç¼–ç " class="headerlink" title="5.èŒƒå¼Huffmanç¼–ç "></a>5.èŒƒå¼Huffmanç¼–ç </h3><h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>huffmanç¼–ç çš„åŸºæœ¬åŸç†æ˜¯æ ¹æ®æ•°æ®ä¸­å…ƒç´ çš„ä½¿ç”¨é¢‘ç‡ï¼Œè°ƒæ•´å…ƒç´ çš„ç¼–ç é•¿åº¦ï¼Œä»¥å¾—åˆ°æ›´é«˜çš„å‹ç¼©æ¯”ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µæ•°æ®</p>
<p><code>AABCBABBCDBBDDBAABDBBDABBBBDDEDBD</code></p>
<p>è¿™æ®µæ•°æ®é‡Œé¢åŒ…å«äº†33ä¸ªå­—ç¬¦ï¼Œæ¯ç§å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ç»Ÿè®¡å¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¬¡æ•°</td>
<td>6</td>
<td>15</td>
<td>2</td>
<td>9</td>
<td>1</td>
<td></td>
</tr>
</tbody>
</table>
<p>å¦‚æœæˆ‘ä»¬ç”¨æˆ‘ä»¬å¸¸è§çš„å®šé•¿ç¼–ç ï¼Œå› ä¸ºæœ‰5ä¸ªæ–‡å­—ï¼Œå¯ä»¥ç”¨3ä¸ªbitè¡¨ç¤ºï¼Œé‚£ä¹ˆè¿™æ®µæ–‡å­—å…±éœ€è¦3*33 = 99ä¸ªbitæ¥ä¿å­˜</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¼–ç </td>
<td>001</td>
<td>010</td>
<td>011</td>
<td>100</td>
<td>101</td>
<td></td>
</tr>
</tbody>
</table>
<p>å¦‚æœæ ¹æ®å­—ç¬¦å‡ºç°çš„æ¦‚ç‡ï¼Œä½¿ç”¨å¦‚ä¸‹çš„ç¼–ç </p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¼–ç </td>
<td>100</td>
<td>0</td>
<td>1110</td>
<td>10</td>
<td>1111</td>
<td></td>
</tr>
</tbody>
</table>
<p>é‚£ä¹ˆè¿™æ®µæ–‡å­—å…±éœ€è¦3<em>6 + 1</em>15 + 4<em>2 + 2</em>9 + 4*1 = 63bitï¼Œå‹ç¼©æ¯”ä¸º63%ã€‚ æ˜¯è¾ƒçŸ­çš„ç¼–ç ä¸èƒ½å¤Ÿæ˜¯è¾ƒé•¿ç¼–ç çš„å‰ç¼€ï¼Œæ¯”å¦‚ä¸Šé¢è¿™ä¸ªç¼–ç ï¼Œå°±æ˜¯ç”±ä¸‹é¢çš„è¿™é¢—äºŒå‰æ ‘ç”Ÿæˆçš„ã€‚<br>å“ˆå¼—æ›¼ç¼–ç ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨äºŒå‰æ ‘æ¥ç”Ÿæˆçš„ï¼Œé¢‘ç‡ä¼šé«˜çš„æ•°æ®å¯¹åº”çš„æ ‘èŠ‚ç‚¹çš„ä½ç½®è¶Šé«˜ã€‚è¿™æ ·å¾—åˆ°çš„ç¼–ç ç¬¦åˆå‰ç¼€è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¾ƒçŸ­çš„ç¼–ç ä¸èƒ½å¤Ÿæ˜¯è¾ƒé•¿ç¼–ç çš„å‰ç¼€ã€‚</p>
<p><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1fb25jyerm4j207h0760sr.jpg" alt="å“ˆå¤«æ›¼æ ‘"></p>
<p><br></p>
<h4 id="Huffmanç¼–ç åœ¨JPEGä¸­"><a href="#Huffmanç¼–ç åœ¨JPEGä¸­" class="headerlink" title="Huffmanç¼–ç åœ¨JPEGä¸­"></a>Huffmanç¼–ç åœ¨JPEGä¸­</h4><p>å‡è®¾åœ¨JPEGé‡åŒ–å¤„ç†åçš„æ•°æ®ä¸ºï¼š<br><code>35,7,0,0,0,-6,-2,0,0,-9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,â€¦,0</code></p>
<p>æ ¹æ®<a href="https://en.wikipedia.org/wiki/Run-length_encoding" target="_blank" rel="external">RLE</a>ç¼–ç (æ¸¸ç¨‹ç¼–ç )è§„åˆ™<br>1ã€ç”¨å›ºå®šçš„4ä½æ¥å­˜å‚¨é‡å¤çš„æ•°é‡ï¼Œæ‰€ä»¥æœ€å¤šé‡å¤å†…å®¹å¯ä»¥è®°å½•æ•°é‡ä¸º15ï¼Œè¶…è¿‡15æ¬¡è¦è¿›è¡Œåˆ†æ®µå¤„ç†ï¼›<br>2ã€åªå°†0ä½œä¸ºé‡å¤çš„å†…å®¹ï¼Œæ¯ä¸ªæ•°å€¼è®°å½•å‰é¢æœ‰å¤šå°‘é‡å¤çš„0ï¼Œæœ«å°¾å¦‚æœéƒ½æ˜¯0ç”¨EOBä½œä¸ºä»£è¡¨ï¼›<br>3ã€æ­¤æ­¥ä¸åŒ…å«ç¬¬ä¸€ä¸ªæ•°å€¼ï¼Œç¬¬ä¸€ä¸ªæ•°ä¸ºç›´æµç³»æ•°ï¼Œæ­¤æ­¥åªå¤„ç†äº¤æµç³»æ•°ã€‚<br>å¾—åˆ°å¤„ç†ç»“æœï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/8b331ee1gw1fb262lkvzaj21kw048ab4.jpg" alt="RLEç¼–ç "><br><br><br><br> </p>
<p>ä¸ºäº†æé«˜å‚¨å­˜æ•ˆç‡, JPEG é‡Œå¹¶ä¸ç›´æ¥ä¿å­˜æ•°å€¼, è€Œæ˜¯å°†æ•°å€¼æŒ‰ä½æ•°åˆ†æˆ 16 ç»„,JPEGæä¾›äº†ä¸€å¼ æ ‡å‡†çš„ç è¡¨ç”¨äºå¯¹è¿™äº›æ•°å­—ç¼–ç <br><img src="http://ww3.sinaimg.cn/large/8b331ee1gw1fb263fusn6j210w0he768.jpg" alt="æ ‡å‡†ç è¡¨"></p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œç¬¬3ä¸ªå•å…ƒä¸­çš„â€œ-6â€è¿™ä¸ªæ•°å­—ï¼Œåœ¨è¡¨ä¸­çš„ä½ç½®æ˜¯é•¿åº¦ä¸º3çš„é‚£ç»„ï¼Œæ‰€å¯¹åº”çš„bitç æ˜¯â€œ001â€ï¼Œç”±äºè¿™ç§ç¼–ç é™„å¸¦é•¿åº¦ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ•°æ®å˜æˆäº†å¦‚ä¸‹çš„æ ¼å¼ã€‚<br><img src="http://ww4.sinaimg.cn/large/8b331ee1gw1fb265nsj1aj21kw065jt8.jpg" alt="BITç¼–ç "><br><br><br><br> </p>
<p>å¯¹äºæ‹¬å·å‰é¢çš„æ•°å­—çš„ç¼–ç ï¼Œåˆ†æˆDCç¼–ç å’ŒACç¼–ç ã€‚<br>ä¸‹è¡¨æ˜¯é’ˆå¯¹ç›´æµ(DC)éƒ¨åˆ†å³ç¬¬ä¸€ä¸ªæ•°å­—çš„å“ˆå¼—æ›¼è¡¨ï¼Œç”±äºç›´æµéƒ¨åˆ†æ²¡æœ‰å‰ç½®çš„0ï¼Œæ‰€ä»¥å–å€¼èŒƒå›´åœ¨0~15ä¹‹é—´ã€‚</p>
<p><img src="http://ww2.sinaimg.cn/mw690/8b331ee1gw1fb26bixac2j20pc0nugmw.jpg" alt=""></p>
<p>å¯¹äºå…¶ä½™çš„äº¤æµï¼ˆACï¼‰éƒ¨åˆ†ï¼Œå–å€¼èŒƒå›´åœ¨0~255ï¼Œå“ˆå¤«æ›¼è¡¨å¦‚ä¸‹ï¼š</p>
<p><img src="http://ww4.sinaimg.cn/mw690/8b331ee1gw1fb26bvyx0oj20q211e410.jpg" alt=""></p>
<p><br><br><br><br>å®Œæ•´ä¸ªç¼–ç è¿‡ç¨‹å¦‚ä¸‹è¡¨ï¼Œæœ€ç»ˆçš„æ•°æ®ä½¿ç”¨10ä¸ªå­—èŠ‚ä¿å­˜äº†åŸæœ¬é•¿åº¦ä¸º64å­—èŠ‚çš„æ•°æ®ï¼ŒJPEGçš„å‹ç¼©ç®—æ³•å®Œæˆã€‚<br><img src="http://ww2.sinaimg.cn/large/8b331ee1gw1fb268ej9k9j21kw09yn0a.jpg" alt=""></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://blog.mrriddler.com/2016/07/20/%E5%9B%BE%E7%89%87%E4%B9%8B%E6%97%85/" target="_blank" rel="external">http://blog.mrriddler.com/2016/07/20/%E5%9B%BE%E7%89%87%E4%B9%8B%E6%97%85/</a></li>
<li><a href="http://thecodeway.com/blog/?p=69" target="_blank" rel="external">http://thecodeway.com/blog/?p=69</a></li>
<li><a href="http://www.impulseadventure.com/photo/jpeg-huffman-coding.html" target="_blank" rel="external">http://www.impulseadventure.com/photo/jpeg-huffman-coding.html</a></li>
<li>ã€Šæ•°å­—å›¾åƒå¤„ç†ç¼–ç¨‹å…¥é—¨ã€‹</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ã€2016-11-26 Hello Worldã€‘]]></title>
      <url>https://The-Coderz.github.io/2016/12/28/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to The Coders! </p>
<p>è¿™æ˜¯ç¼–ç¨‹è€…è”ç›Ÿçš„ç¬¬ä¸€ç¯‡åšå®¢ã€‚æˆ‘ä»¬ä¼šåœ¨è¿™é‡Œä¸å®šæœŸåœ°æ›´æ–°ä¸€äº›æŠ€æœ¯åˆ†äº«ã€‚</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ã€2016-12-02 Javaç¼–ç å°ç»“ã€‘]]></title>
      <url>https://The-Coderz.github.io/2016/12/03/2016-12-02-Java%E7%BC%96%E7%A0%81%E5%B0%8F%E7%BB%93/</url>
      <content type="html"><![CDATA[<hr>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç¼–ç é—®é¢˜ä¸€ç›´éƒ½æ˜¯ä»¤ç¨‹åºå‘˜æ‰æ‘¸ä¸é€çš„ä¸œè¥¿ï¼Œå› ä¸ºå®ƒè¢«è¶Šæ¥è¶Šé€æ˜åŒ–ï¼šç¨‹åºä¸­é»˜è®¤ç”¨OSçš„å­—ç¬¦é›†ã€è®¸å¤šæ–‡ä»¶å¼€å¤´éƒ½æœ‰ç¼–ç æ ¼å¼çš„çº¦å®šâ€¦â€¦è¿™å°±å¯¼è‡´ä¸€æ—¦é‡åˆ°ä¹±ç çš„ç°è±¡ï¼Œå°±è®©äººæ— ä»ä¸‹æ‰‹ï¼Œæ‰€ä»¥åœ¨äº†è§£äº†ä¸€éƒ¨åˆ†çŸ¥è¯†å’Œå®ç°ä¹‹åï¼Œæˆ‘æƒ³å¯¹Javaçš„ç¼–ç åšä¸€ä¸‹å°ç»“ï¼Œæ–¹ä¾¿æ—¥åè‡ªå·±æŸ¥é˜…ã€‚</p>
<hr>
<h3 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h3><ul>
<li>ç¼–ç ï¼šé¦–å…ˆï¼Œâ€œç¼–ç â€ä¸€è¯é€šå¸¸æ˜¯ä½œä¸ºåŠ¨è¯ï¼Œå³<strong>æŠŠä¸€ç§ç¬¦å·åºåˆ—é€šè¿‡æŸç§è§„çº¦è½¬åŒ–ä¸ºå¦ä¸€ç§ç¬¦å·åºåˆ—ï¼Œä¸”è¯­ä¹‰ä¿æŒä¸€è‡´</strong>ï¼ˆæˆ‘è‡ªå·±å®šä¹‰çš„ï¼‰ï¼›</li>
<li>è§£ç ï¼šç¼–ç çš„åå‘è¿‡ç¨‹ï¼›</li>
<li>äºŒè¿›åˆ¶ï¼šåœ¨è®¡ç®—æœºä¸­ï¼Œä¿¡æ¯çš„è¡¨ç¤ºæœ€å°å•ä½ä¸ºä½ï¼Œç”±0æˆ–1ç»„æˆï¼Œè¿™ä¸€ç‰¹æ€§æ˜¯é€šè¿‡ç”µä¿¡å·çš„æœ‰æ— æ¥å†³å®šçš„ï¼›</li>
<li>å­—èŠ‚ï¼šè®¡ç®—æœºå­˜å‚¨ä¿¡æ¯çš„æœ€å°å•ä½ï¼Œä¸€ä¸ªå­—èŠ‚(Byte)=8ä½(bit)ï¼›</li>
<li>å­—ç¬¦ï¼šè¿™æ˜¯å¸¦æœ‰äººç±»èƒ½è¯»æ‡‚è¯­ä¹‰çš„æœ€å°å•ä½ï¼Œå¦‚:A,æˆ‘ï¼›</li>
<li>å­—ç¬¦é›†ï¼šç”¨æ¥å°†â€œå­—èŠ‚è§£ç ä¸ºå­—ç¬¦â€æˆ–â€œå­—ç¬¦ç¼–ç ä¸ºå­—èŠ‚â€çš„äººç±»è§„çº¦ï¼Œæœ‰å¤šç§è§„çº¦ï¼Œå¦‚ï¼šANSIã€GBKã€UTF-8ã€UTF-16ã€iso-8859-1ç­‰ï¼›  </li>
</ul>
<hr>
<h3 id="Javaç¼–ç "><a href="#Javaç¼–ç " class="headerlink" title="Javaç¼–ç "></a>Javaç¼–ç </h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; è¿™ä¸ªæ ‡é¢˜èµ·å¾—å¥½åƒæœ‰äº›å¥‡æ€ªï¼Œå› ä¸ºå®ƒæ­§ä¹‰ç‰¹åˆ«å¤šï¼Œç”±äºæœ¬æ–‡æ˜¯æŒ‰ç…§æˆ‘çš„æ€è·¯æ¥å†™çš„ï¼Œä¹Ÿå°±å‹‰ä¸ºå…¶éš¾åœ°è·Ÿç€æˆ‘çš„å­¦ä¹ æ€è·¯èµ°å§ ï¼šï¼‰ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; é¦–å…ˆï¼Œå¾ˆå¤šäººï¼ˆæ¯”å¦‚æˆ‘ï¼‰å°±ä¼šé‡åˆ°ç¬¬ä¸€ä¸ªæ··æ·†çš„æ¦‚å¿µï¼šJavaç¼–ç =&gt;æŒ‡çš„æ˜¯Javaçš„ä»€ä¹ˆç¼–ç ï¼š  </p>
<ol>
<li>Javaç¼–è¯‘ï¼šåœ¨æ²¡æœ‰æŒ‡å®šç¼–è¯‘æ—¶çš„ç¼–ç æ—¶ï¼ŒJavaé‡‡ç”¨Unicodeç¼–ç ã€‚è¿™æ„å‘³ç€ï¼ŒJavaç¼–è¯‘å™¨ä¼šå°†å½“å‰ä»£ç çš„ç¼–ç è½¬æ¢ä¸ºUnicodeç»Ÿä¸€ç¼–ç ï¼Œè¿™æ ·ï¼Œåœ¨ä¸åŒç¯å¢ƒä¸‹ï¼Œ.classæ–‡ä»¶éƒ½èƒ½æ­£ç¡®åœ°è¾“å‡ºæ–‡ä»¶å†…å®¹ï¼›  </li>
<li>JVMçš„ç¼–ç æ ¼å¼ï¼šåœ¨æ²¡æœ‰æŒ‡å®šJVMçš„ç¼–ç æ ¼å¼æ—¶ï¼ŒJavaç¨‹åºå°†ä¼šç”¨OSçš„é»˜è®¤ç¼–ç ï¼›</li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å½“å¯¹è¿™ä¸¤ç‚¹æœ‰æ‰€åŒºåˆ†ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»†ç»†è€ƒç©¶æŸä¸€ä¸ªä»£ç ç‰‡æ®µé€ æˆçš„ä¹±ç é—®é¢˜äº†ã€‚ä½†æ˜¯è¯·ç¨ç­‰ï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´Javaä¸­çš„charå’ŒByteå§ï¼Ÿ  </p>
<h4 id="charç±»å‹"><a href="#charç±»å‹" class="headerlink" title="charç±»å‹"></a>charç±»å‹</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; æˆ‘ä»¬è¦äº†è§£ï¼Œå­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„å†…å®¹éƒ½æ˜¯ç»è¿‡ç¼–ç åçš„å†…å®¹ï¼Œæ­¤æ—¶å°±è¦æˆ‘ä»¬æ˜ç¡®ä»¥æŸç§æ–¹å¼è¯»å–ï¼ˆè§£ç ï¼‰ä¸ºcharç±»å‹ã€‚å…¶å®è¯´åˆ°åº•ï¼Œå­—ç¬¦ç±»å‹ï¼ˆcharï¼‰æ— éå°±æ˜¯å¯¹å­—èŠ‚ç±»å‹ï¼ˆbyteï¼‰çš„æŸç§ç»„åˆã€‚ç”±äºäºŒè¿›åˆ¶ï¼ˆbitï¼‰åˆ°å­—èŠ‚ï¼ˆbyteï¼‰ï¼Œå…¶å®åªæ˜¯ç£ç›˜æ–‡ä»¶åˆ°å†…å­˜çš„ç›´æ¥æ˜ å°„ï¼ˆè¿™ä¸ªç›´æ¥æ˜ å°„è¡¨ç¤ºæ²¡æœ‰ä»€ä¹ˆæ”¹å˜ï¼Œè€Œä¸æ˜¯ç‰©ç†å­˜å‚¨ä¸Šçš„æŸç§å…³ç³»ï¼‰ï¼Œæ‰€ä»¥ä¸éœ€è¦åšä»€ä¹ˆç¼–ç çš„æ“ä½œã€‚ä½†æ˜¯ä»å­—èŠ‚ï¼ˆbyteï¼‰åˆ°å­—ç¬¦ï¼ˆcharï¼‰ï¼Œå°±éœ€è¦åšç¼–ç çš„æ“ä½œï¼Œæ¥ç¡®å®šè°‹è€…æ˜ å°„å…³ç³»ï¼Œä»è€Œæ‰“å°åˆ°å±å¹•ä¸Šèƒ½è¢«äººç±»æ‰€ç†è§£ï¼ˆè¿™ä¸å°±æ˜¯æœ€ç»ˆç›®æ ‡å—ï¼‰ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“Javaæ˜¯ä¸€é—¨OOPè¯­è¨€ï¼Œå®ƒå¯¹åŠ¨ä½œçš„å°è£…å…¶å®æŒºå…¨é¢çš„ï¼Œä¸è¿‡æ­£æ˜¯å› ä¸ºå®ƒçš„é€æ˜æ€§ï¼Œå¯¼è‡´æˆ‘å¯¹æœŸé—´çš„ç¼–ç ä¸€çŸ¥åŠè§£ï¼Œæ‰€ä»¥ï¼Œäº†è§£å®ƒçš„ç»“æ„ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚charç±»å‹çš„å®ä½“åœ¨Javaä¸­å æœ‰<strong>ä¸¤ä¸ªå­—èŠ‚å¤§å°ï¼Œç”¨æ¥è¡¨ç¤ºUnicodeè§£ç åçš„å­—ç¬¦</strong>ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å¯¹åº”æ¯”ä¸‹C++å’ŒJavaä¸­å­—ç¬¦å’Œå­—èŠ‚çš„è¡¨ç¤ºç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç±»å‹æˆ–æ“ä½œ</th>
<th style="text-align:center">C++</th>
<th style="text-align:center">Java</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å­—èŠ‚</td>
<td style="text-align:center">char</td>
<td style="text-align:center">byte</td>
</tr>
<tr>
<td style="text-align:left">å­—ç¬¦</td>
<td style="text-align:center">wchar_t</td>
<td style="text-align:center">char</td>
</tr>
<tr>
<td style="text-align:left">ANSIå­—ç¬¦ä¸²</td>
<td style="text-align:center">char[]</td>
<td style="text-align:center">byte[]</td>
</tr>
<tr>
<td style="text-align:left">Unicodeå­—ç¬¦ä¸²</td>
<td style="text-align:center">wchar_t[]</td>
<td style="text-align:center">String</td>
</tr>
<tr>
<td style="text-align:left">å­—ç¬¦ä¸²=&gt;å­—èŠ‚ä¸²</td>
<td style="text-align:center">wcstombs(), WideCharToMultiByte()</td>
<td style="text-align:center">String.getBytes(encoding)</td>
</tr>
<tr>
<td style="text-align:left">å­—èŠ‚ä¸²=&gt;å­—ç¬¦ä¸²</td>
<td style="text-align:center">mbstowcs(), MultiByteToWideChar()</td>
<td style="text-align:center">new String(bytes,encoding)</td>
</tr>
</tbody>
</table>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; è¦æ³¨æ„c/c++çš„charç±»å‹å’ŒJavaä¸­charç±»å‹çš„åŒºåˆ«ï¼Œä¸è¦â€œä¸€è§†åŒä»â€ã€‚</p>
<p><img src="/images/2016/12/04/001.png" alt="Java IOè¯»"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ä»è¿™å¼ UMLå›¾ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼ŒJavaé€šè¿‡InputStreamReaderç±»è¿™ä¸ªæ¡¥æ¢ï¼Œæ¥å®ç°å­—èŠ‚åˆ°å­—ç¬¦çš„è½¬æ¢ï¼Œå³è§£ç çš„è¿‡ç¨‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">InputStream fileByteInputStream = <span class="keyword">new</span> FileInputStream(<span class="string">"/xx/xx/xx.txt"</span>);</div><div class="line">InputStreamReader fileInputStreamReader = <span class="keyword">new</span> InputStreamReader(fileByteInputStream, <span class="string">"GBK"</span>);  <span class="comment">// ä»¥GBKçš„æ–¹å¼è§£ç äºŒè¿›åˆ¶æµ</span></div><div class="line">BufferedReader reader = <span class="keyword">new</span> BufferedReader(fileInputStreamReader);</div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; åŒç†ï¼ŒJava IOä¸­çš„å†™ä¹Ÿæœ‰charåˆ°byteçš„æ¡¥æ¢:  </p>
<p><img src="/images/2016/12/04/002.png" alt="Java IOå†™">  </p>
<h4 id="Stringå¯¹è±¡"><a href="#Stringå¯¹è±¡" class="headerlink" title="Stringå¯¹è±¡"></a>Stringå¯¹è±¡</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Stringå¯¹è±¡è¢«å«åšå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå…¶å†…éƒ¨æ˜¯å­˜å‚¨äº†ä¸€ä¸ªchar[]æ•°ç»„ï¼Œè¿™æ„å‘³ç€ï¼Œè¿™äº›å­—ç¬¦éƒ½æ˜¯ç»è¿‡ç‰¹å®šè§£ç çš„ï¼š  </p>
<pre><code class="Java">String s = <span class="keyword">new</span> String(<span class="string">"ä½ "</span>.getBytes(<span class="string">"GBK"</span>), <span class="string">"GBK"</span>);
String a = <span class="keyword">new</span> String(<span class="string">"ä½ "</span>.getBytes(<span class="string">"UTF-8"</span>));
System.out.println(s);
System.out.println(a);
</code></pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ä»ä¸Šè¿°ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºä¸¤ç‚¹ï¼š  </p>
<ol>
<li>Javaç¼–è¯‘ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šç¼–ç ï¼Œåˆ™ä¼šä½¿ç”¨Unicodeï¼Œå…·ä½“æ˜¯UTF-8ç¼–ç æ¥å­˜å‚¨åˆ°.classä¸­ï¼›</li>
<li>Javaçš„Stringå¯¹è±¡ä¸­å­˜å‚¨çš„char[]éƒ½æ˜¯ç”¨Unicodeï¼Œå…·ä½“æ˜¯UTF-8æ¥å­˜å‚¨çš„ã€‚</li>
</ol>
]]></content>
    </entry>
    
  
  
</search>
